<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.427">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Chelsea Parlett-Pelleriti">

<title>Bare Bones Model Examples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="barebones_files/libs/clipboard/clipboard.min.js"></script>
<script src="barebones_files/libs/quarto-html/quarto.js"></script>
<script src="barebones_files/libs/quarto-html/popper.min.js"></script>
<script src="barebones_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="barebones_files/libs/quarto-html/anchor.min.js"></script>
<link href="barebones_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="barebones_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="barebones_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="barebones_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="barebones_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a></li>
  <li><a href="#supervised-machine-learning" id="toc-supervised-machine-learning" class="nav-link" data-scroll-target="#supervised-machine-learning"><span class="header-section-number">2</span> Supervised Machine Learning</a>
  <ul class="collapse">
  <li><a href="#regression-continuous-outcome" id="toc-regression-continuous-outcome" class="nav-link" data-scroll-target="#regression-continuous-outcome"><span class="header-section-number">2.1</span> Regression (Continuous Outcome)</a></li>
  <li><a href="#classification-categorical-outcome" id="toc-classification-categorical-outcome" class="nav-link" data-scroll-target="#classification-categorical-outcome"><span class="header-section-number">2.2</span> Classification (Categorical Outcome)</a></li>
  </ul></li>
  <li><a href="#unsupervised-machine-learning" id="toc-unsupervised-machine-learning" class="nav-link" data-scroll-target="#unsupervised-machine-learning"><span class="header-section-number">3</span> Unsupervised Machine Learning</a>
  <ul class="collapse">
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering"><span class="header-section-number">3.1</span> Clustering</a>
  <ul class="collapse">
  <li><a href="#kmeans" id="toc-kmeans" class="nav-link" data-scroll-target="#kmeans"><span class="header-section-number">3.1.1</span> KMeans</a></li>
  <li><a href="#gaussian-mixture-model" id="toc-gaussian-mixture-model" class="nav-link" data-scroll-target="#gaussian-mixture-model"><span class="header-section-number">3.1.2</span> Gaussian Mixture Model</a></li>
  <li><a href="#dbscan" id="toc-dbscan" class="nav-link" data-scroll-target="#dbscan"><span class="header-section-number">3.1.3</span> DBSCAN</a></li>
  <li><a href="#hierarchical-agglomerative-clustering" id="toc-hierarchical-agglomerative-clustering" class="nav-link" data-scroll-target="#hierarchical-agglomerative-clustering"><span class="header-section-number">3.1.4</span> Hierarchical Agglomerative Clustering</a></li>
  </ul></li>
  <li><a href="#dimensionality-reduction" id="toc-dimensionality-reduction" class="nav-link" data-scroll-target="#dimensionality-reduction"><span class="header-section-number">3.2</span> Dimensionality Reduction</a>
  <ul class="collapse">
  <li><a href="#pca" id="toc-pca" class="nav-link" data-scroll-target="#pca"><span class="header-section-number">3.2.1</span> PCA</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bare Bones Model Examples</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Chelsea Parlett-Pelleriti </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Overview</h1>
<p>The following sections provide annotated bare-bones examples of how to run each algorithm we learn in class. This only includes data loading, pre-procesing, model building, and basic model evaluation and <strong>does not</strong> include all the extras we learn in class (like plotting, hyper-parameter tuning..etc).</p>
</section>
<section id="supervised-machine-learning" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Supervised Machine Learning</h1>
<p>In supervised ML the general workflow is:</p>
<ul>
<li>Create <code>X</code> and <code>y</code> (includes pre-processing, model validationâ€¦etc)</li>
<li>Create empty model</li>
<li><code>.fit()</code></li>
<li><code>.predict()</code></li>
<li>Evaluate</li>
</ul>
<section id="regression-continuous-outcome" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="regression-continuous-outcome"><span class="header-section-number">2.1</span> Regression (Continuous Outcome)</h2>
<details>
<summary>
Linear Regression (No Model Validation)
</summary>
<section id="loading-and-pre-processing" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression <span class="co"># Linear Regression Model</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>z.fit(X[continuous]) <span class="co"># z score all predictors that are continuous/interval</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>X[continuous] <span class="op">=</span> z.transform(X[continuous]) <span class="co"># z score all predictors that are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="build-and-fit-the-model" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>LR_Model <span class="op">=</span> LinearRegression() <span class="co"># empty model</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>LR_Model.fit(X, y) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1113">
<style>#sk-container-id-78 {color: black;background-color: white;}#sk-container-id-78 pre{padding: 0;}#sk-container-id-78 div.sk-toggleable {background-color: white;}#sk-container-id-78 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-78 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-78 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-78 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-78 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-78 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-78 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-78 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-78 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-78 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-78 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-78 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-78 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-78 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-78 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-78 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-78 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-78 div.sk-item {position: relative;z-index: 1;}#sk-container-id-78 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-78 div.sk-item::before, #sk-container-id-78 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-78 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-78 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-78 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-78 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-78 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-78 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-78 div.sk-label-container {text-align: center;}#sk-container-id-78 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-78 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-78" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-78" type="checkbox" checked=""><label for="sk-estimator-id-78" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>price_pred <span class="op">=</span> LR_Model.predict(X) <span class="co"># make predictions for data in X</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE: "</span>, mean_squared_error(y,price_pred))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE: "</span>, mean_absolute_error(y,price_pred))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 : "</span>, r2_score(y,price_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE:  10.410351383442405
MAE:  2.1524134686888465
R2 :  0.9221000651451909</code></pre>
</div>
</div>
</section></details>
<details>
<summary>
Linear Regression
</summary>
<section>
</section>
<section id="loading-and-pre-processing-1" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-1">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression <span class="co"># Linear Regression Model</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-1" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-1">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>LR_Model <span class="op">=</span> LinearRegression() <span class="co"># empty model</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>LR_Model.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1122">
<style>#sk-container-id-79 {color: black;background-color: white;}#sk-container-id-79 pre{padding: 0;}#sk-container-id-79 div.sk-toggleable {background-color: white;}#sk-container-id-79 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-79 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-79 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-79 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-79 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-79 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-79 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-79 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-79 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-79 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-79 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-79 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-79 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-79 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-79 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-79 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-79 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-79 div.sk-item {position: relative;z-index: 1;}#sk-container-id-79 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-79 div.sk-item::before, #sk-container-id-79 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-79 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-79 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-79 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-79 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-79 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-79 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-79 div.sk-label-container {text-align: center;}#sk-container-id-79 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-79 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-79" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-79" type="checkbox" checked=""><label for="sk-estimator-id-79" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-1" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-1">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> LR_Model.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> LR_Model.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  14.522324832425639
Train MAE:  2.4011724430804393
Train R2 :  0.917710061297125
Test MSE :  13.709790397895697
Test MAE :  2.5167973932367524
Test R2  :  0.8877009796549696</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    LR_Model <span class="op">=</span> LinearRegression() <span class="co"># empty model</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    LR_Model.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> LR_Model.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> LR_Model.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  9.927933291761963
MSE test :  15.313409506242559
MAE train:  2.135255452113144
MAE test :  2.312819139035335
R2 train :  0.9246411494920055
R2 test  :  0.8668890953933325</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
K-Nearest Neighbors Regression
</summary>
<section>
</section>
<section id="loading-and-pre-processing-2" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-2">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor <span class="co"># KNN Regression Model</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-2" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-2">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>KNN <span class="op">=</span> KNeighborsRegressor() <span class="co"># empty model</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>KNN.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1132">
<style>#sk-container-id-80 {color: black;background-color: white;}#sk-container-id-80 pre{padding: 0;}#sk-container-id-80 div.sk-toggleable {background-color: white;}#sk-container-id-80 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-80 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-80 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-80 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-80 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-80 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-80 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-80 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-80 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-80 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-80 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-80 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-80 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-80 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-80 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-80 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-80 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-80 div.sk-item {position: relative;z-index: 1;}#sk-container-id-80 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-80 div.sk-item::before, #sk-container-id-80 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-80 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-80 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-80 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-80 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-80 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-80 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-80 div.sk-label-container {text-align: center;}#sk-container-id-80 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-80 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-80" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsRegressor()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-80" type="checkbox" checked=""><label for="sk-estimator-id-80" class="sk-toggleable__label sk-toggleable__label-arrow">KNeighborsRegressor</label><div class="sk-toggleable__content"><pre>KNeighborsRegressor()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-2" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-2">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> KNN.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> KNN.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  5.221000580645159
Train MAE:  1.7421612903225805
Train R2 :  0.6477515749408516
Test MSE :  130.70290249999996
Test MAE :  3.5702822580645166
Test R2  :  0.19309048847354304</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-1" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-1">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    KNN <span class="op">=</span> KNeighborsRegressor() <span class="co"># empty model</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    KNN.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> KNN.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> KNN.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  20.110612603225803
MSE test :  41.063131651612885
MAE train:  1.910456451612903
MAE test :  2.6680451612903227
R2 train :  0.8312397716206533
R2 test  :  0.6346890819435238</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Regression Trees
</summary>
<section>
</section>
<section id="loading-and-pre-processing-3" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-3">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor <span class="co"># Regression Tree Model</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-3" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-3">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> DecisionTreeRegressor() <span class="co"># empty model</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>tree.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1142">
<style>#sk-container-id-81 {color: black;background-color: white;}#sk-container-id-81 pre{padding: 0;}#sk-container-id-81 div.sk-toggleable {background-color: white;}#sk-container-id-81 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-81 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-81 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-81 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-81 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-81 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-81 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-81 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-81 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-81 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-81 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-81 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-81 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-81 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-81 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-81 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-81 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-81 div.sk-item {position: relative;z-index: 1;}#sk-container-id-81 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-81 div.sk-item::before, #sk-container-id-81 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-81 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-81 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-81 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-81 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-81 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-81 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-81 div.sk-label-container {text-align: center;}#sk-container-id-81 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-81 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-81" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>DecisionTreeRegressor()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-81" type="checkbox" checked=""><label for="sk-estimator-id-81" class="sk-toggleable__label sk-toggleable__label-arrow">DecisionTreeRegressor</label><div class="sk-toggleable__content"><pre>DecisionTreeRegressor()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-3" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-3">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> tree.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> tree.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  0.0
Train MAE:  0.0
Train R2 :  1.0
Test MSE :  56.93600564516128
Test MAE :  2.697741935483871
Test R2  :  0.6260643008059015</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-2" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-2">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> DecisionTreeRegressor() <span class="co"># empty model</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>    tree.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> tree.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> tree.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  7.741935483870982e-06
MSE test :  23.140444193548383
MAE train:  0.00019354838709680373
MAE test :  2.1846129032258066
R2 train :  0.9999999471483024
R2 test  :  0.778752264724252</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Random Forest Regression
</summary>
<section>
</section>
<section id="loading-and-pre-processing-4" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-4">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor <span class="co"># Regression RF Model</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-4" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-4">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> RandomForestRegressor() <span class="co"># empty model</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>tree.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1152">
<style>#sk-container-id-82 {color: black;background-color: white;}#sk-container-id-82 pre{padding: 0;}#sk-container-id-82 div.sk-toggleable {background-color: white;}#sk-container-id-82 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-82 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-82 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-82 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-82 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-82 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-82 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-82 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-82 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-82 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-82 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-82 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-82 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-82 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-82 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-82 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-82 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-82 div.sk-item {position: relative;z-index: 1;}#sk-container-id-82 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-82 div.sk-item::before, #sk-container-id-82 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-82 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-82 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-82 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-82 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-82 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-82 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-82 div.sk-label-container {text-align: center;}#sk-container-id-82 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-82 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-82" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestRegressor()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-82" type="checkbox" checked=""><label for="sk-estimator-id-82" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-4" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-4">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> tree.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> tree.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  1.027887486935485
Train MAE:  0.7316209677419346
Train R2 :  0.9264927274294827
Test MSE :  132.96865555451615
Test MAE :  3.3754596774193546
Test R2  :  0.18085917376329042</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-3" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-3">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> RandomForestRegressor() <span class="co"># empty model</span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>    tree.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> tree.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> tree.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  3.8830621876552285
MSE test :  18.020421804512743
MAE train:  0.7204637811059893
MAE test :  1.8100066973886322
R2 train :  0.9678954409227101
R2 test  :  0.841596341243443</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
LASSO
</summary>
<section>
</section>
<section id="loading-and-pre-processing-5" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-5">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Lasso <span class="co"># Lasso Model</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-5" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-5">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> Lasso() <span class="co"># empty model</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>lasso.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1162">
<style>#sk-container-id-83 {color: black;background-color: white;}#sk-container-id-83 pre{padding: 0;}#sk-container-id-83 div.sk-toggleable {background-color: white;}#sk-container-id-83 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-83 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-83 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-83 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-83 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-83 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-83 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-83 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-83 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-83 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-83 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-83 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-83 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-83 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-83 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-83 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-83 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-83 div.sk-item {position: relative;z-index: 1;}#sk-container-id-83 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-83 div.sk-item::before, #sk-container-id-83 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-83 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-83 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-83 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-83 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-83 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-83 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-83 div.sk-label-container {text-align: center;}#sk-container-id-83 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-83 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-83" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Lasso()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-83" type="checkbox" checked=""><label for="sk-estimator-id-83" class="sk-toggleable__label sk-toggleable__label-arrow">Lasso</label><div class="sk-toggleable__content"><pre>Lasso()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-5" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-5">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> lasso.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> lasso.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  19.563355029111886
Train MAE:  2.639715369532352
Train R2 :  0.9439560493486779
Test MSE :  8.962346854668148
Test MAE :  2.180447064812281
Test R2  :  0.8829062410890771</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-4" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-4">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>    lasso <span class="op">=</span> Lasso() <span class="co"># empty model</span></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>    lasso.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> lasso.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> lasso.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb74-55"><a href="#cb74-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb74-56"><a href="#cb74-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-57"><a href="#cb74-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb74-58"><a href="#cb74-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  12.861874716043413
MSE test :  15.57473623154267
MAE train:  2.202272118628502
MAE test :  2.241309062687665
R2 train :  0.9018835434834364
R2 test  :  0.8077525440964433</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Ridge
</summary>
<section>
</section>
<section id="loading-and-pre-processing-6" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-6">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Ridge <span class="co"># Ridge Model</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-6" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-6">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>ridge <span class="op">=</span> Ridge() <span class="co"># empty model</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>ridge.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1172">
<style>#sk-container-id-84 {color: black;background-color: white;}#sk-container-id-84 pre{padding: 0;}#sk-container-id-84 div.sk-toggleable {background-color: white;}#sk-container-id-84 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-84 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-84 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-84 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-84 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-84 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-84 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-84 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-84 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-84 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-84 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-84 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-84 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-84 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-84 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-84 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-84 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-84 div.sk-item {position: relative;z-index: 1;}#sk-container-id-84 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-84 div.sk-item::before, #sk-container-id-84 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-84 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-84 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-84 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-84 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-84 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-84 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-84 div.sk-label-container {text-align: center;}#sk-container-id-84 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-84 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-84" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Ridge()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-84" type="checkbox" checked=""><label for="sk-estimator-id-84" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-6" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-6">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> ridge.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> ridge.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  4.932061711321575
Train MAE:  1.5414355302353653
Train R2 :  0.7175288952119367
Test MSE :  27.0841448504829
Test MAE :  2.334298593705109
Test R2  :  0.8324813798253551</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-5" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-5">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>    ridge <span class="op">=</span> Ridge() <span class="co"># empty model</span></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>    ridge.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> ridge.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> ridge.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-57"><a href="#cb87-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb87-58"><a href="#cb87-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  9.89739200409971
MSE test :  16.141089384637564
MAE train:  2.132498013130327
MAE test :  2.2769822312433794
R2 train :  0.9239723222906224
R2 test  :  0.8507294005576556</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Neural Network
</summary>
<section>
</section>
<section id="loading-and-pre-processing-7" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-7">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow.keras <span class="im">as</span> kb</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-7" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-7">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#structure of the model</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> kb.Sequential([</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    kb.layers.Dense(<span class="dv">1</span>, input_shape <span class="op">=</span>[<span class="dv">7</span>]), <span class="co">#input</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co">#how to train the model</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">"mean_squared_error"</span>,</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>              optimizer <span class="op">=</span> kb.optimizers.SGD())</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="co">#fit the model (same as SKlearn)</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>model.fit(X_train,y_train, epochs <span class="op">=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 282.73722/2 [==============================] - 1s 18ms/step - loss: 329.2491
Epoch 2/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 195.08922/2 [==============================] - 0s 6ms/step - loss: 290.6619
Epoch 3/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 248.01032/2 [==============================] - 0s 11ms/step - loss: 254.4820
Epoch 4/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 223.02862/2 [==============================] - 0s 6ms/step - loss: 225.3177
Epoch 5/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 250.03342/2 [==============================] - 0s 7ms/step - loss: 200.6822</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1182">
<pre><code>&lt;keras.callbacks.History at 0x7fe92ee1e7c0&gt;</code></pre>
</div>
</div>
</section>
<section id="evaluate-the-model-7" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-7">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> model.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> model.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 5ms/step
Train MSE:  183.86726373228723
Train MAE:  10.517841813795028
Train R2 :  -0.2832339890839568
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 2ms/step
Test MSE :  169.98509085033137
Test MAE :  9.225459772002312
Test R2  :  -0.2996748991818001</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<p><strong>NOTE</strong>: Weâ€™re building a pretty simple feed forward NN here, once the models get a little bigger, K-Fold can sometimes be too computationally expensive to run.</p>
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-6" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-6">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#structure of the model</span></span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> kb.Sequential([</span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>        kb.layers.Dense(<span class="dv">1</span>, input_shape <span class="op">=</span>[<span class="dv">7</span>]), <span class="co">#input</span></span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#how to train the model</span></span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">"mean_squared_error"</span>,</span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a>                  optimizer <span class="op">=</span> kb.optimizers.SGD())</span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">#fit the model (same as SKlearn)</span></span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train,y_train, epochs <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> model.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb102-43"><a href="#cb102-43" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> model.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb102-44"><a href="#cb102-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-45"><a href="#cb102-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb102-46"><a href="#cb102-46" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb102-47"><a href="#cb102-47" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb102-48"><a href="#cb102-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-49"><a href="#cb102-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb102-50"><a href="#cb102-50" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb102-51"><a href="#cb102-51" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb102-52"><a href="#cb102-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-53"><a href="#cb102-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb102-54"><a href="#cb102-54" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb102-55"><a href="#cb102-55" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb102-56"><a href="#cb102-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-57"><a href="#cb102-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb102-58"><a href="#cb102-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb102-59"><a href="#cb102-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-60"><a href="#cb102-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb102-61"><a href="#cb102-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb102-62"><a href="#cb102-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-63"><a href="#cb102-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb102-64"><a href="#cb102-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/5
1/8 [==&gt;...........................] - ETA: 5s - loss: 189.37968/8 [==============================] - 1s 3ms/step - loss: 269.0854
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 295.38258/8 [==============================] - 0s 3ms/step - loss: 174.7522
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 94.05478/8 [==============================] - 0s 3ms/step - loss: 120.2160
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 43.76038/8 [==============================] - 0s 3ms/step - loss: 85.1495
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 23.72688/8 [==============================] - 0s 3ms/step - loss: 63.9095
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 2ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 5ms/step
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 4s - loss: 179.90728/8 [==============================] - 1s 2ms/step - loss: 287.3272
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 88.64138/8 [==============================] - 0s 2ms/step - loss: 181.7008
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 56.58108/8 [==============================] - 0s 2ms/step - loss: 120.4620
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 115.37278/8 [==============================] - 0s 3ms/step - loss: 83.9937
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 18.93208/8 [==============================] - 0s 2ms/step - loss: 61.9629
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 2ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 4ms/step
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 3s - loss: 170.21818/8 [==============================] - 1s 2ms/step - loss: 281.2620
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 548.78348/8 [==============================] - 0s 2ms/step - loss: 175.7737
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 45.62898/8 [==============================] - 0s 2ms/step - loss: 119.7909
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 60.85628/8 [==============================] - 0s 3ms/step - loss: 83.1242
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 24.87598/8 [==============================] - 0s 2ms/step - loss: 59.7955
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 1ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 3ms/step
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 2s - loss: 332.00638/8 [==============================] - 0s 2ms/step - loss: 273.9075
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 117.56448/8 [==============================] - 0s 2ms/step - loss: 176.9366
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 51.81378/8 [==============================] - 0s 2ms/step - loss: 121.7919
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 45.43048/8 [==============================] - 0s 2ms/step - loss: 86.0537
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 265.77778/8 [==============================] - 0s 2ms/step - loss: 64.2959
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 2ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 3ms/step
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 2s - loss: 505.15628/8 [==============================] - 0s 3ms/step - loss: 200.0959
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 98.47078/8 [==============================] - 0s 2ms/step - loss: 131.6864
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 36.45648/8 [==============================] - 0s 2ms/step - loss: 90.5324
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 31.07598/8 [==============================] - 0s 2ms/step - loss: 64.8973
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 70.23368/8 [==============================] - 0s 2ms/step - loss: 48.5055
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 2ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 4ms/step
MSE train:  49.48527628306435
MSE test :  54.64995902527369
MAE train:  4.139018326013319
MAE test :  4.202961943226476
R2 train :  0.6239133321133068
R2 test  :  0.5904604478672024</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
</section>
</section>
<section id="classification-categorical-outcome" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="classification-categorical-outcome"><span class="header-section-number">2.2</span> Classification (Categorical Outcome)</h2>
<details>
<summary>
Logistic Regression
</summary>
<section>
<section id="loading-and-pre-processing-8" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-8">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, roc_auc_score, confusion_matrix <span class="co">#model evaluation</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/heart.csv"</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># heart.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age         0
sex         0
cp          0
trestbps    0
chol        0
fbs         0
restecg     0
thalach     0
exang       0
oldpeak     0
slope       0
ca          0
thal        0
target      0
dtype: int64
(303, 14)</code></pre>
</div>
</div>
<p>There arenâ€™t any missing values here, but weâ€™ll go through the motions anyway (it wonâ€™t negatively impact our analysis).</p>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also create dummy variables for our categorical/ordinal variables if they have more than 2 (0/1) categories.</p>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"cp"</span>,</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="st">"trestbps"</span>,<span class="st">"chol"</span>,<span class="st">"fbs"</span>,<span class="st">"restecg"</span>,</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="st">"thalach"</span>,<span class="st">"exang"</span>,<span class="st">"oldpeak"</span>,<span class="st">"slope"</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>,<span class="st">"ca"</span>,<span class="st">"thal"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> heart[predictors] <span class="co"># predictors/input</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> heart[<span class="st">"target"</span>] <span class="co"># outcome/output</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span> [<span class="st">"cp"</span>, <span class="st">"slope"</span>, <span class="st">"thal"</span>], drop_first <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those.</p>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-8" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-8">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LogisticRegression() <span class="co"># create empty model</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>lr.fit(X_train, y_train) <span class="co"># fit model (aka find the best parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1192">
<style>#sk-container-id-85 {color: black;background-color: white;}#sk-container-id-85 pre{padding: 0;}#sk-container-id-85 div.sk-toggleable {background-color: white;}#sk-container-id-85 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-85 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-85 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-85 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-85 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-85 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-85 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-85 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-85 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-85 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-85 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-85 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-85 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-85 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-85 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-85 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-85 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-85 div.sk-item {position: relative;z-index: 1;}#sk-container-id-85 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-85 div.sk-item::before, #sk-container-id-85 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-85 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-85 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-85 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-85 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-85 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-85 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-85 div.sk-label-container {text-align: center;}#sk-container-id-85 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-85 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-85" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LogisticRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-85" type="checkbox" checked=""><label for="sk-estimator-id-85" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-8" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-8">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦)</p>
<p>All of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>pred_train <span class="op">=</span> lr.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>pred_train_proba <span class="op">=</span> lr.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Acc: "</span>, accuracy_score(y_train,pred_train))</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train AUC: "</span>, roc_auc_score(y_train,pred_train_proba))</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train CM : "</span>, confusion_matrix(y_train,pred_train))</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>pred_test <span class="op">=</span> lr.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>pred_test_proba <span class="op">=</span> lr.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test Acc : "</span>, accuracy_score(y_test,pred_test))</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test AUC : "</span>, roc_auc_score(y_test,pred_test_proba))</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test CM  : "</span>, confusion_matrix(y_test,pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train Acc:  0.8360655737704918
Train AUC:  0.9433551198257081
Train CM :  [[21  6]
 [ 4 30]]
Test Acc :  0.7851239669421488
Test AUC :  0.8698851523279004
Test CM  :  [[ 76  35]
 [ 17 114]]</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those.</p>
<section id="model-building-and-evaluation-7" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-7">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦). Because weâ€™re doing K-Fold CV, weâ€™ll have K different Accuracies, ROC AUCs, and Confusion Matrices for the train/test set. So, we store all K of them in lists (<code>acc_train</code>, <code>acc_test</code>â€¦etc), and print out the confusion matrices for each model.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>acc_train <span class="op">=</span> []</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>acc_test  <span class="op">=</span> []</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>auc_train <span class="op">=</span> []</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>auc_test  <span class="op">=</span> []</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create empty model</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>    lr <span class="op">=</span> LogisticRegression()</span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>    lr.fit(X_train,y_train)</span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb115-32"><a href="#cb115-32" aria-hidden="true" tabindex="-1"></a>    pred_train <span class="op">=</span> lr.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb115-33"><a href="#cb115-33" aria-hidden="true" tabindex="-1"></a>    pred_train_proba <span class="op">=</span> lr.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb115-34"><a href="#cb115-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-35"><a href="#cb115-35" aria-hidden="true" tabindex="-1"></a>    pred_test <span class="op">=</span> lr.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb115-36"><a href="#cb115-36" aria-hidden="true" tabindex="-1"></a>    pred_test_proba <span class="op">=</span> lr.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb115-37"><a href="#cb115-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-38"><a href="#cb115-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># acc</span></span>
<span id="cb115-39"><a href="#cb115-39" aria-hidden="true" tabindex="-1"></a>    acc_train.append(accuracy_score(y_train, pred_train))</span>
<span id="cb115-40"><a href="#cb115-40" aria-hidden="true" tabindex="-1"></a>    acc_test.append(accuracy_score(y_test, pred_test))</span>
<span id="cb115-41"><a href="#cb115-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-42"><a href="#cb115-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># auc</span></span>
<span id="cb115-43"><a href="#cb115-43" aria-hidden="true" tabindex="-1"></a>    auc_train.append(roc_auc_score(y_train, pred_train_proba))</span>
<span id="cb115-44"><a href="#cb115-44" aria-hidden="true" tabindex="-1"></a>    auc_test.append(roc_auc_score(y_test, pred_test_proba))</span>
<span id="cb115-45"><a href="#cb115-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb115-46"><a href="#cb115-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cm</span></span>
<span id="cb115-47"><a href="#cb115-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_train, pred_train))</span>
<span id="cb115-48"><a href="#cb115-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_test, pred_test))</span>
<span id="cb115-49"><a href="#cb115-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-50"><a href="#cb115-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc train: "</span>, np.mean(acc_train))</span>
<span id="cb115-51"><a href="#cb115-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc test : "</span>, np.mean(acc_test))   </span>
<span id="cb115-52"><a href="#cb115-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-53"><a href="#cb115-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC train: "</span>, np.mean(auc_train))</span>
<span id="cb115-54"><a href="#cb115-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC test : "</span>, np.mean(auc_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 92  16]
 [ 11 123]]
[[21  9]
 [ 5 26]]
[[ 87  22]
 [ 15 118]]
[[25  4]
 [ 3 29]]
[[ 95  18]
 [ 13 116]]
[[15 10]
 [ 3 33]]
[[ 89  21]
 [ 13 120]]
[[21  7]
 [ 2 30]]
[[ 90  22]
 [ 12 119]]
[[26  0]
 [ 7 27]]
Acc train:  0.8655205251164848
Acc test :  0.835191256830601
AUC train:  0.9316676964244663
AUC test :  0.9035527972226796</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></section></details>
<details>
<summary>
KNN
</summary>
<section>
</section>
<section id="loading-and-pre-processing-9" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-9">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, roc_auc_score, confusion_matrix <span class="co">#model evaluation</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/heart.csv"</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co"># heart.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age         0
sex         0
cp          0
trestbps    0
chol        0
fbs         0
restecg     0
thalach     0
exang       0
oldpeak     0
slope       0
ca          0
thal        0
target      0
dtype: int64
(303, 14)</code></pre>
</div>
</div>
<p>There arenâ€™t any missing values here, but weâ€™ll go through the motions anyway (it wonâ€™t negatively impact our analysis).</p>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also create dummy variables for our categorical/ordinal variables if they have more than 2 (0/1) categories.</p>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"cp"</span>,</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="st">"trestbps"</span>,<span class="st">"chol"</span>,<span class="st">"fbs"</span>,<span class="st">"restecg"</span>,</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="st">"thalach"</span>,<span class="st">"exang"</span>,<span class="st">"oldpeak"</span>,<span class="st">"slope"</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>,<span class="st">"ca"</span>,<span class="st">"thal"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> heart[predictors] <span class="co"># predictors/input</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> heart[<span class="st">"target"</span>] <span class="co"># outcome/output</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span> [<span class="st">"cp"</span>, <span class="st">"slope"</span>, <span class="st">"thal"</span>], drop_first <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our continuous inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those. Because weâ€™re going to do hyperparameter tuning to choose <code>k</code> (the number of neighbors to look at), weâ€™ll create a z-score object using <code>make_column_transformer</code>. This function takes in two <em>very</em> important arguments.</p>
<ul>
<li>first, it takes in a <em>tuple</em> that contains both the transformation we want to apply (here: <code>StandardScaler()</code>), and the columns we want to transform with that transformation (here: <code>continuous</code>)</li>
<li><code>remainder = "passthrough"</code> which tells python not to drop/remove all the non-z-scored columns</li>
</ul>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> make_column_transformer((StandardScaler(), continuous),</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>remainder <span class="op">=</span> <span class="st">"passthrough"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-9" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-9">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model and put it and our <code>z</code> object into a pipeline, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. <em>However</em>, because we want to do hyperparameter tuning via <code>GridSearchCV</code>, weâ€™ll need to first create a grid search object, and tell it which hyperparameters to try (these hyperparameter options are stored in the dictionary <code>ks</code>).</p>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>knn <span class="op">=</span> KNeighborsClassifier() <span class="co"># create empty model</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pipeline</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> make_pipeline(z,knn)</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="co"># hyperparams</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>ks <span class="op">=</span> {<span class="st">"kneighborsclassifier__n_neighbors"</span>: <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>)}</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="co"># grid</span></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, ks, scoring <span class="op">=</span> <span class="st">"accuracy"</span>, cv <span class="op">=</span> <span class="dv">5</span>, refit <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train) <span class="co"># fit model (aka find the best parameters)</span></span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a><span class="co"># what k did it choose??</span></span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"k chosen:"</span>, grid.best_estimator_.get_params()[<span class="st">"kneighborsclassifier__n_neighbors"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>k chosen: 2</code></pre>
</div>
</div>
</section>
<section id="evaluate-the-model-9" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-9">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦)</p>
<p>All of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>pred_train <span class="op">=</span> grid.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>pred_train_proba <span class="op">=</span> grid.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Acc: "</span>, accuracy_score(y_train,pred_train))</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train AUC: "</span>, roc_auc_score(y_train,pred_train_proba))</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train CM : "</span>, confusion_matrix(y_train,pred_train))</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>pred_test <span class="op">=</span> grid.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>pred_test_proba <span class="op">=</span> grid.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test Acc : "</span>, accuracy_score(y_test,pred_test))</span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test AUC : "</span>, roc_auc_score(y_test,pred_test_proba))</span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test CM  : "</span>, confusion_matrix(y_test,pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train Acc:  0.9016393442622951
Train AUC:  0.9675324675324675
Train CM :  [[28  0]
 [ 6 27]]
Test Acc :  0.7272727272727273
Test AUC :  0.7839187327823691
Test CM  :  [[87 23]
 [43 89]]</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll create a z-score object. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those, the rest will be left alone because we set <code>remainder = "passthrough"</code>.</p>
<section id="model-building-and-evaluation-8" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-8">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model and put it and our <code>z</code> object into a pipeline, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. <em>However</em>, because we want to do hyperparameter tuning via <code>GridSearchCV</code>, weâ€™ll need to first create a grid search object, and tell it which hyperparameters to try (these hyperparameter options are stored in the dictionary <code>ks</code>).</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦). Because weâ€™re doing K-Fold CV, weâ€™ll have K different Accuracies, ROC AUCs, and Confusion Matrices for the train/test set. So, we store all K of them in lists (<code>acc_train</code>, <code>acc_test</code>â€¦etc), and print out the confusion matrices for each model.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>acc_train <span class="op">=</span> []</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>acc_test  <span class="op">=</span> []</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>auc_train <span class="op">=</span> []</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>auc_test  <span class="op">=</span> []</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>    continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> make_column_transformer((StandardScaler(), continuous),</span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">"passthrough"</span>)</span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># model</span></span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a>    knn <span class="op">=</span> KNeighborsClassifier() <span class="co"># create empty model</span></span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pipeline</span></span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>    pipe <span class="op">=</span> make_pipeline(z,knn)</span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># hyperparams</span></span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a>    ks <span class="op">=</span> {<span class="st">"kneighborsclassifier__n_neighbors"</span>: <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>)}</span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grid</span></span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> GridSearchCV(pipe, ks, scoring <span class="op">=</span> <span class="st">"accuracy"</span>, cv <span class="op">=</span> <span class="dv">5</span>, refit <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-37"><a href="#cb129-37" aria-hidden="true" tabindex="-1"></a>    grid.fit(X_train, y_train) <span class="co"># fit model (aka find the best parameters)</span></span>
<span id="cb129-38"><a href="#cb129-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-39"><a href="#cb129-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># what k did it choose??</span></span>
<span id="cb129-40"><a href="#cb129-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"k chosen: "</span>, grid.best_estimator_.get_params()[<span class="st">"kneighborsclassifier__n_neighbors"</span>])</span>
<span id="cb129-41"><a href="#cb129-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb129-42"><a href="#cb129-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb129-43"><a href="#cb129-43" aria-hidden="true" tabindex="-1"></a>    pred_train <span class="op">=</span> grid.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb129-44"><a href="#cb129-44" aria-hidden="true" tabindex="-1"></a>    pred_train_proba <span class="op">=</span> grid.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb129-45"><a href="#cb129-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-46"><a href="#cb129-46" aria-hidden="true" tabindex="-1"></a>    pred_test <span class="op">=</span> grid.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb129-47"><a href="#cb129-47" aria-hidden="true" tabindex="-1"></a>    pred_test_proba <span class="op">=</span> grid.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb129-48"><a href="#cb129-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb129-49"><a href="#cb129-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># acc</span></span>
<span id="cb129-50"><a href="#cb129-50" aria-hidden="true" tabindex="-1"></a>    acc_train.append(accuracy_score(y_train, pred_train))</span>
<span id="cb129-51"><a href="#cb129-51" aria-hidden="true" tabindex="-1"></a>    acc_test.append(accuracy_score(y_test, pred_test))</span>
<span id="cb129-52"><a href="#cb129-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb129-53"><a href="#cb129-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># auc</span></span>
<span id="cb129-54"><a href="#cb129-54" aria-hidden="true" tabindex="-1"></a>    auc_train.append(roc_auc_score(y_train, pred_train_proba))</span>
<span id="cb129-55"><a href="#cb129-55" aria-hidden="true" tabindex="-1"></a>    auc_test.append(roc_auc_score(y_test, pred_test_proba))</span>
<span id="cb129-56"><a href="#cb129-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb129-57"><a href="#cb129-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cm</span></span>
<span id="cb129-58"><a href="#cb129-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_train, pred_train))</span>
<span id="cb129-59"><a href="#cb129-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_test, pred_test))</span>
<span id="cb129-60"><a href="#cb129-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-61"><a href="#cb129-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc train: "</span>, np.mean(acc_train))</span>
<span id="cb129-62"><a href="#cb129-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc test : "</span>, np.mean(acc_test))   </span>
<span id="cb129-63"><a href="#cb129-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-64"><a href="#cb129-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC train: "</span>, np.mean(auc_train))</span>
<span id="cb129-65"><a href="#cb129-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC test : "</span>, np.mean(auc_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>k chosen:  19
[[ 90  24]
 [ 15 113]]
[[19  5]
 [ 8 29]]
k chosen:  28
[[ 79  25]
 [ 17 121]]
[[25  9]
 [ 5 22]]
k chosen:  20
[[ 91  21]
 [ 19 111]]
[[18  8]
 [ 8 27]]
k chosen:  5
[[ 89  19]
 [ 15 120]]
[[23  7]
 [ 3 27]]
k chosen:  5
[[ 94  20]
 [ 15 114]]
[[19  5]
 [ 7 29]]
Acc train:  0.8432098765432098
Acc test :  0.7856830601092897
AUC train:  0.919452773048915
AUC test :  0.8778657686451805</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Naive Bayes
</summary>
<section>
</section>
<section id="loading-and-pre-processing-10" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-10">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> GaussianNB, CategoricalNB</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, roc_auc_score, confusion_matrix <span class="co">#model evaluation</span></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/heart.csv"</span>)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="co"># heart.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age         0
sex         0
cp          0
trestbps    0
chol        0
fbs         0
restecg     0
thalach     0
exang       0
oldpeak     0
slope       0
ca          0
thal        0
target      0
dtype: int64
(303, 14)</code></pre>
</div>
</div>
<p>There arenâ€™t any missing values here, but weâ€™ll go through the motions anyway (it wonâ€™t negatively impact our analysis).</p>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also create dummy variables for our categorical/ordinal variables if they have more than 2 (0/1) categories.</p>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"cp"</span>,</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="st">"trestbps"</span>,<span class="st">"chol"</span>,<span class="st">"fbs"</span>,<span class="st">"restecg"</span>,</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="st">"thalach"</span>,<span class="st">"exang"</span>,<span class="st">"oldpeak"</span>,<span class="st">"slope"</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>,<span class="st">"ca"</span>,<span class="st">"thal"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> heart[predictors] <span class="co"># predictors/input</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> heart[<span class="st">"target"</span>] <span class="co"># outcome/output</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span> [<span class="st">"cp"</span>, <span class="st">"slope"</span>, <span class="st">"thal"</span>], drop_first <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our continuous inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those.</p>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-10" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-10">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. Weâ€™ll use only our continuous predictors with a <code>GaussianNB</code> model, however we could use the categorical predictors with a <code>CategoricalNB</code> model as well (you can even multiply the output of the two models to get a single Naive Bayes model that uses both! See <a href="https://stackoverflow.com/questions/14254203/mixing-categorial-and-continuous-data-in-naive-bayes-classifier-using-scikit-lea">here</a>).</p>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>nb <span class="op">=</span> GaussianNB() <span class="co"># create empty model</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>nb.fit(X_train[continuous], y_train) <span class="co"># fit the model (aka calculate the probabilities)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1212">
<style>#sk-container-id-86 {color: black;background-color: white;}#sk-container-id-86 pre{padding: 0;}#sk-container-id-86 div.sk-toggleable {background-color: white;}#sk-container-id-86 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-86 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-86 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-86 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-86 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-86 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-86 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-86 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-86 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-86 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-86 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-86 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-86 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-86 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-86 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-86 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-86 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-86 div.sk-item {position: relative;z-index: 1;}#sk-container-id-86 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-86 div.sk-item::before, #sk-container-id-86 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-86 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-86 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-86 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-86 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-86 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-86 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-86 div.sk-label-container {text-align: center;}#sk-container-id-86 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-86 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-86" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GaussianNB()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-86" type="checkbox" checked=""><label for="sk-estimator-id-86" class="sk-toggleable__label sk-toggleable__label-arrow">GaussianNB</label><div class="sk-toggleable__content"><pre>GaussianNB()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-10" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-10">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦)</p>
<p>All of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>pred_train <span class="op">=</span> nb.predict(X_train[continuous]) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>pred_train_proba <span class="op">=</span> nb.predict_proba(X_train[continuous])[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Acc: "</span>, accuracy_score(y_train,pred_train))</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train AUC: "</span>, roc_auc_score(y_train,pred_train_proba))</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train CM : "</span>, confusion_matrix(y_train,pred_train))</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>pred_test <span class="op">=</span> nb.predict(X_test[continuous]) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>pred_test_proba <span class="op">=</span> nb.predict_proba(X_test[continuous])[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test Acc : "</span>, accuracy_score(y_test,pred_test))</span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test AUC : "</span>, roc_auc_score(y_test,pred_test_proba))</span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test CM  : "</span>, confusion_matrix(y_test,pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train Acc:  0.6557377049180327
Train AUC:  0.7462365591397849
Train CM :  [[18 13]
 [ 8 22]]
Test Acc :  0.71900826446281
Test AUC :  0.7792315680166148
Test CM  :  [[75 32]
 [36 99]]</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll create a z-score object. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those, the rest will be left alone because we set <code>remainder = "passthrough"</code>.</p>
<section id="model-building-and-evaluation-9" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-9">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model and put it and our <code>z</code> object into a pipeline, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. <em>However</em>, because we want to do hyperparameter tuning via <code>GridSearchCV</code>, weâ€™ll need to first create a grid search object, and tell it which hyperparameters to try (these hyperparameter options are stored in the dictionary <code>ks</code>).</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦). Because weâ€™re doing K-Fold CV, weâ€™ll have K different Accuracies, ROC AUCs, and Confusion Matrices for the train/test set. So, we store all K of them in lists (<code>acc_train</code>, <code>acc_test</code>â€¦etc), and print out the confusion matrices for each model.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>acc_train <span class="op">=</span> []</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>acc_test  <span class="op">=</span> []</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>auc_train <span class="op">=</span> []</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>auc_test  <span class="op">=</span> []</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>    continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb142-24"><a href="#cb142-24" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb142-25"><a href="#cb142-25" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb142-26"><a href="#cb142-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb142-27"><a href="#cb142-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create empty model</span></span>
<span id="cb142-28"><a href="#cb142-28" aria-hidden="true" tabindex="-1"></a>    nb <span class="op">=</span> GaussianNB()</span>
<span id="cb142-29"><a href="#cb142-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-30"><a href="#cb142-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb142-31"><a href="#cb142-31" aria-hidden="true" tabindex="-1"></a>    nb.fit(X_train[continuous], y_train)</span>
<span id="cb142-32"><a href="#cb142-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb142-33"><a href="#cb142-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb142-34"><a href="#cb142-34" aria-hidden="true" tabindex="-1"></a>    pred_train <span class="op">=</span> nb.predict(X_train[continuous]) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb142-35"><a href="#cb142-35" aria-hidden="true" tabindex="-1"></a>    pred_train_proba <span class="op">=</span> nb.predict_proba(X_train[continuous])[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb142-36"><a href="#cb142-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-37"><a href="#cb142-37" aria-hidden="true" tabindex="-1"></a>    pred_test <span class="op">=</span> nb.predict(X_test[continuous]) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb142-38"><a href="#cb142-38" aria-hidden="true" tabindex="-1"></a>    pred_test_proba <span class="op">=</span> nb.predict_proba(X_test[continuous])[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb142-39"><a href="#cb142-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb142-40"><a href="#cb142-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># acc</span></span>
<span id="cb142-41"><a href="#cb142-41" aria-hidden="true" tabindex="-1"></a>    acc_train.append(accuracy_score(y_train, pred_train))</span>
<span id="cb142-42"><a href="#cb142-42" aria-hidden="true" tabindex="-1"></a>    acc_test.append(accuracy_score(y_test, pred_test))</span>
<span id="cb142-43"><a href="#cb142-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb142-44"><a href="#cb142-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># auc</span></span>
<span id="cb142-45"><a href="#cb142-45" aria-hidden="true" tabindex="-1"></a>    auc_train.append(roc_auc_score(y_train, pred_train_proba))</span>
<span id="cb142-46"><a href="#cb142-46" aria-hidden="true" tabindex="-1"></a>    auc_test.append(roc_auc_score(y_test, pred_test_proba))</span>
<span id="cb142-47"><a href="#cb142-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb142-48"><a href="#cb142-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cm</span></span>
<span id="cb142-49"><a href="#cb142-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_train, pred_train))</span>
<span id="cb142-50"><a href="#cb142-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_test, pred_test))</span>
<span id="cb142-51"><a href="#cb142-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-52"><a href="#cb142-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc train: "</span>, np.mean(acc_train))</span>
<span id="cb142-53"><a href="#cb142-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc test : "</span>, np.mean(acc_test))   </span>
<span id="cb142-54"><a href="#cb142-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-55"><a href="#cb142-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC train: "</span>, np.mean(auc_train))</span>
<span id="cb142-56"><a href="#cb142-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC test : "</span>, np.mean(auc_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 70  40]
 [ 29 103]]
[[19  9]
 [ 4 29]]
[[ 73  37]
 [ 22 110]]
[[18 10]
 [11 22]]
[[ 71  37]
 [ 25 109]]
[[19 11]
 [ 7 24]]
[[ 78  35]
 [ 26 104]]
[[11 14]
 [ 5 30]]
[[ 67  44]
 [ 27 105]]
[[21  6]
 [ 6 27]]
Acc train:  0.7343332313029282
Acc test :  0.7261748633879781
AUC train:  0.8046660527965388
AUC test :  0.79434720373215</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Decision Trees
</summary>
<section>
</section>
<section id="loading-and-pre-processing-11" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-11">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, roc_auc_score, confusion_matrix <span class="co">#model evaluation</span></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/heart.csv"</span>)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="co"># heart.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age         0
sex         0
cp          0
trestbps    0
chol        0
fbs         0
restecg     0
thalach     0
exang       0
oldpeak     0
slope       0
ca          0
thal        0
target      0
dtype: int64
(303, 14)</code></pre>
</div>
</div>
<p>There arenâ€™t any missing values here, but weâ€™ll go through the motions anyway (it wonâ€™t negatively impact our analysis).</p>
<div class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also create dummy variables for our categorical/ordinal variables if they have more than 2 (0/1) categories.</p>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"cp"</span>,</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="st">"trestbps"</span>,<span class="st">"chol"</span>,<span class="st">"fbs"</span>,<span class="st">"restecg"</span>,</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="st">"thalach"</span>,<span class="st">"exang"</span>,<span class="st">"oldpeak"</span>,<span class="st">"slope"</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>,<span class="st">"ca"</span>,<span class="st">"thal"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> heart[predictors] <span class="co"># predictors/input</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> heart[<span class="st">"target"</span>] <span class="co"># outcome/output</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span> [<span class="st">"cp"</span>, <span class="st">"slope"</span>, <span class="st">"thal"</span>], drop_first <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our continuous inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those. Because weâ€™re going to do hyperparameter tuning to choose <code>k</code> (the number of neighbors to look at), weâ€™ll create a z-score object using <code>make_column_transformer</code>. This function takes in two <em>very</em> important arguments.</p>
<ul>
<li>first, it takes in a <em>tuple</em> that contains both the transformation we want to apply (here: <code>StandardScaler()</code>), and the columns we want to transform with that transformation (here: <code>continuous</code>)</li>
<li><code>remainder = "passthrough"</code> which tells python not to drop/remove all the non-z-scored columns</li>
</ul>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> make_column_transformer((StandardScaler(), continuous),</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>remainder <span class="op">=</span> <span class="st">"passthrough"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-11" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-11">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model and put it and our <code>z</code> object into a pipeline, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. <em>However</em>, because we want to do hyperparameter tuning via <code>GridSearchCV</code>, weâ€™ll need to first create a grid search object, and tell it which hyperparameters to try (these hyperparameter options are stored in the dictionary <code>msl</code>).</p>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> DecisionTreeClassifier() <span class="co"># create empty model</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pipeline</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> make_pipeline(z,dt)</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="co"># hyperparams</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>msl <span class="op">=</span> {<span class="st">"decisiontreeclassifier__min_samples_leaf"</span>: <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">50</span>)}</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a><span class="co"># grid</span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, msl, scoring <span class="op">=</span> <span class="st">"accuracy"</span>, cv <span class="op">=</span> <span class="dv">5</span>, refit <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train) <span class="co"># fit model (aka find the best parameters)</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a><span class="co"># what k did it choose??</span></span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"min samples leaf chosen:"</span>, grid.best_estimator_.get_params()[<span class="st">"decisiontreeclassifier__min_samples_leaf"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>min samples leaf chosen: 2</code></pre>
</div>
</div>
</section>
<section id="evaluate-the-model-11" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-11">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦)</p>
<p>All of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>pred_train <span class="op">=</span> grid.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>pred_train_proba <span class="op">=</span> grid.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Acc: "</span>, accuracy_score(y_train,pred_train))</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train AUC: "</span>, roc_auc_score(y_train,pred_train_proba))</span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train CM : "</span>, confusion_matrix(y_train,pred_train))</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>pred_test <span class="op">=</span> grid.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a>pred_test_proba <span class="op">=</span> grid.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test Acc : "</span>, accuracy_score(y_test,pred_test))</span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test AUC : "</span>, roc_auc_score(y_test,pred_test_proba))</span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test CM  : "</span>, confusion_matrix(y_test,pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train Acc:  0.9508196721311475
Train AUC:  0.9944444444444445
Train CM :  [[35  1]
 [ 2 23]]
Test Acc :  0.6528925619834711
Test AUC :  0.7112394957983194
Test CM  :  [[77 25]
 [59 81]]</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll create a z-score object. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those, the rest will be left alone because we set <code>remainder = "passthrough"</code>.</p>
<section id="model-building-and-evaluation-10" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-10">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model and put it and our <code>z</code> object into a pipeline, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. <em>However</em>, because we want to do hyperparameter tuning via <code>GridSearchCV</code>, weâ€™ll need to first create a grid search object, and tell it which hyperparameters to try (these hyperparameter options are stored in the dictionary <code>ks</code>).</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦). Because weâ€™re doing K-Fold CV, weâ€™ll have K different Accuracies, ROC AUCs, and Confusion Matrices for the train/test set. So, we store all K of them in lists (<code>acc_train</code>, <code>acc_test</code>â€¦etc), and print out the confusion matrices for each model.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>acc_train <span class="op">=</span> []</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>acc_test  <span class="op">=</span> []</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>auc_train <span class="op">=</span> []</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>auc_test  <span class="op">=</span> []</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>    continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> make_column_transformer((StandardScaler(), continuous),</span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">"passthrough"</span>)</span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># model</span></span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> DecisionTreeClassifier() <span class="co"># create empty model</span></span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pipeline</span></span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>    pipe <span class="op">=</span> make_pipeline(z,dt)</span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># hyperparams</span></span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a>    msl <span class="op">=</span> {<span class="st">"decisiontreeclassifier__min_samples_leaf"</span>: <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>)}</span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grid</span></span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> GridSearchCV(pipe, msl, scoring <span class="op">=</span> <span class="st">"accuracy"</span>, cv <span class="op">=</span> <span class="dv">5</span>, refit <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a>    grid.fit(X_train, y_train) <span class="co"># fit model (aka find the best parameters)</span></span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-39"><a href="#cb156-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># what k did it choose??</span></span>
<span id="cb156-40"><a href="#cb156-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"min samples leaf chosen: "</span>, grid.best_estimator_.get_params()[<span class="st">"decisiontreeclassifier__min_samples_leaf"</span>])</span>
<span id="cb156-41"><a href="#cb156-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-42"><a href="#cb156-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb156-43"><a href="#cb156-43" aria-hidden="true" tabindex="-1"></a>    pred_train <span class="op">=</span> grid.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb156-44"><a href="#cb156-44" aria-hidden="true" tabindex="-1"></a>    pred_train_proba <span class="op">=</span> grid.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb156-45"><a href="#cb156-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-46"><a href="#cb156-46" aria-hidden="true" tabindex="-1"></a>    pred_test <span class="op">=</span> grid.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb156-47"><a href="#cb156-47" aria-hidden="true" tabindex="-1"></a>    pred_test_proba <span class="op">=</span> grid.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb156-48"><a href="#cb156-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-49"><a href="#cb156-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># acc</span></span>
<span id="cb156-50"><a href="#cb156-50" aria-hidden="true" tabindex="-1"></a>    acc_train.append(accuracy_score(y_train, pred_train))</span>
<span id="cb156-51"><a href="#cb156-51" aria-hidden="true" tabindex="-1"></a>    acc_test.append(accuracy_score(y_test, pred_test))</span>
<span id="cb156-52"><a href="#cb156-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-53"><a href="#cb156-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># auc</span></span>
<span id="cb156-54"><a href="#cb156-54" aria-hidden="true" tabindex="-1"></a>    auc_train.append(roc_auc_score(y_train, pred_train_proba))</span>
<span id="cb156-55"><a href="#cb156-55" aria-hidden="true" tabindex="-1"></a>    auc_test.append(roc_auc_score(y_test, pred_test_proba))</span>
<span id="cb156-56"><a href="#cb156-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb156-57"><a href="#cb156-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cm</span></span>
<span id="cb156-58"><a href="#cb156-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_train, pred_train))</span>
<span id="cb156-59"><a href="#cb156-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_test, pred_test))</span>
<span id="cb156-60"><a href="#cb156-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-61"><a href="#cb156-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc train: "</span>, np.mean(acc_train))</span>
<span id="cb156-62"><a href="#cb156-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc test : "</span>, np.mean(acc_test))   </span>
<span id="cb156-63"><a href="#cb156-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-64"><a href="#cb156-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC train: "</span>, np.mean(auc_train))</span>
<span id="cb156-65"><a href="#cb156-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC test : "</span>, np.mean(auc_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>min samples leaf chosen:  13
[[ 91  20]
 [ 19 112]]
[[23  4]
 [ 7 27]]
min samples leaf chosen:  6
[[ 93  18]
 [  9 122]]
[[19  8]
 [ 7 27]]
min samples leaf chosen:  10
[[ 99  20]
 [ 15 108]]
[[14  5]
 [ 7 35]]
min samples leaf chosen:  13
[[ 80  25]
 [  9 129]]
[[26  7]
 [ 5 22]]
min samples leaf chosen:  5
[[ 93  13]
 [ 18 119]]
[[22 10]
 [ 9 19]]
Acc train:  0.8630309832330034
Acc test :  0.7720765027322404
AUC train:  0.9445461313646037
AUC test :  0.8167469703081481</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Random Forest
</summary>
<section>
</section>
<section id="loading-and-pre-processing-12" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-12">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, roc_auc_score, confusion_matrix <span class="co">#model evaluation</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/heart.csv"</span>)</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="co"># heart.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age         0
sex         0
cp          0
trestbps    0
chol        0
fbs         0
restecg     0
thalach     0
exang       0
oldpeak     0
slope       0
ca          0
thal        0
target      0
dtype: int64
(303, 14)</code></pre>
</div>
</div>
<p>There arenâ€™t any missing values here, but weâ€™ll go through the motions anyway (it wonâ€™t negatively impact our analysis).</p>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also create dummy variables for our categorical/ordinal variables if they have more than 2 (0/1) categories.</p>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"cp"</span>,</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="st">"trestbps"</span>,<span class="st">"chol"</span>,<span class="st">"fbs"</span>,<span class="st">"restecg"</span>,</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="st">"thalach"</span>,<span class="st">"exang"</span>,<span class="st">"oldpeak"</span>,<span class="st">"slope"</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>,<span class="st">"ca"</span>,<span class="st">"thal"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> heart[predictors] <span class="co"># predictors/input</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> heart[<span class="st">"target"</span>] <span class="co"># outcome/output</span></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span> [<span class="st">"cp"</span>, <span class="st">"slope"</span>, <span class="st">"thal"</span>], drop_first <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those.</p>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-12" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-12">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier() <span class="co"># create empty model</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train) <span class="co"># fit model (aka find the best parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1232">
<style>#sk-container-id-87 {color: black;background-color: white;}#sk-container-id-87 pre{padding: 0;}#sk-container-id-87 div.sk-toggleable {background-color: white;}#sk-container-id-87 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-87 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-87 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-87 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-87 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-87 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-87 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-87 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-87 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-87 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-87 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-87 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-87 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-87 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-87 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-87 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-87 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-87 div.sk-item {position: relative;z-index: 1;}#sk-container-id-87 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-87 div.sk-item::before, #sk-container-id-87 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-87 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-87 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-87 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-87 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-87 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-87 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-87 div.sk-label-container {text-align: center;}#sk-container-id-87 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-87 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-87" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-87" type="checkbox" checked=""><label for="sk-estimator-id-87" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-12" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-12">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦)</p>
<p>All of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>pred_train <span class="op">=</span> rf.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>pred_train_proba <span class="op">=</span> rf.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Acc: "</span>, accuracy_score(y_train,pred_train))</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train AUC: "</span>, roc_auc_score(y_train,pred_train_proba))</span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train CM : "</span>, confusion_matrix(y_train,pred_train))</span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>pred_test <span class="op">=</span> rf.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>pred_test_proba <span class="op">=</span> rf.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test Acc : "</span>, accuracy_score(y_test,pred_test))</span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test AUC : "</span>, roc_auc_score(y_test,pred_test_proba))</span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-21"><a href="#cb167-21" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb167-22"><a href="#cb167-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test CM  : "</span>, confusion_matrix(y_test,pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train Acc:  1.0
Train AUC:  0.9999999999999999
Train CM :  [[29  0]
 [ 0 32]]
Test Acc :  0.7851239669421488
Test AUC :  0.8904945850865696
Test CM  :  [[ 88  21]
 [ 31 102]]</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those.</p>
<section id="model-building-and-evaluation-11" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-11">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦). Because weâ€™re doing K-Fold CV, weâ€™ll have K different Accuracies, ROC AUCs, and Confusion Matrices for the train/test set. So, we store all K of them in lists (<code>acc_train</code>, <code>acc_test</code>â€¦etc), and print out the confusion matrices for each model.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>acc_train <span class="op">=</span> []</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>acc_test  <span class="op">=</span> []</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>auc_train <span class="op">=</span> []</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>auc_test  <span class="op">=</span> []</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb169-22"><a href="#cb169-22" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb169-23"><a href="#cb169-23" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb169-24"><a href="#cb169-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb169-25"><a href="#cb169-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create empty model</span></span>
<span id="cb169-26"><a href="#cb169-26" aria-hidden="true" tabindex="-1"></a>    rf <span class="op">=</span> RandomForestClassifier()</span>
<span id="cb169-27"><a href="#cb169-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-28"><a href="#cb169-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb169-29"><a href="#cb169-29" aria-hidden="true" tabindex="-1"></a>    rf.fit(X_train,y_train)</span>
<span id="cb169-30"><a href="#cb169-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb169-31"><a href="#cb169-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb169-32"><a href="#cb169-32" aria-hidden="true" tabindex="-1"></a>    pred_train <span class="op">=</span> rf.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb169-33"><a href="#cb169-33" aria-hidden="true" tabindex="-1"></a>    pred_train_proba <span class="op">=</span> rf.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb169-34"><a href="#cb169-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-35"><a href="#cb169-35" aria-hidden="true" tabindex="-1"></a>    pred_test <span class="op">=</span> rf.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb169-36"><a href="#cb169-36" aria-hidden="true" tabindex="-1"></a>    pred_test_proba <span class="op">=</span> rf.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb169-37"><a href="#cb169-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb169-38"><a href="#cb169-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># acc</span></span>
<span id="cb169-39"><a href="#cb169-39" aria-hidden="true" tabindex="-1"></a>    acc_train.append(accuracy_score(y_train, pred_train))</span>
<span id="cb169-40"><a href="#cb169-40" aria-hidden="true" tabindex="-1"></a>    acc_test.append(accuracy_score(y_test, pred_test))</span>
<span id="cb169-41"><a href="#cb169-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb169-42"><a href="#cb169-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># auc</span></span>
<span id="cb169-43"><a href="#cb169-43" aria-hidden="true" tabindex="-1"></a>    auc_train.append(roc_auc_score(y_train, pred_train_proba))</span>
<span id="cb169-44"><a href="#cb169-44" aria-hidden="true" tabindex="-1"></a>    auc_test.append(roc_auc_score(y_test, pred_test_proba))</span>
<span id="cb169-45"><a href="#cb169-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb169-46"><a href="#cb169-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cm</span></span>
<span id="cb169-47"><a href="#cb169-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_train, pred_train))</span>
<span id="cb169-48"><a href="#cb169-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_test, pred_test))</span>
<span id="cb169-49"><a href="#cb169-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-50"><a href="#cb169-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc train: "</span>, np.mean(acc_train))</span>
<span id="cb169-51"><a href="#cb169-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc test : "</span>, np.mean(acc_test))   </span>
<span id="cb169-52"><a href="#cb169-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-53"><a href="#cb169-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC train: "</span>, np.mean(auc_train))</span>
<span id="cb169-54"><a href="#cb169-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC test : "</span>, np.mean(auc_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[104   0]
 [  0 138]]
[[23 11]
 [ 4 23]]
[[115   0]
 [  0 127]]
[[19  4]
 [12 26]]
[[117   0]
 [  0 125]]
[[12  9]
 [ 2 38]]
[[108   0]
 [  0 135]]
[[24  6]
 [ 4 26]]
[[108   0]
 [  0 135]]
[[26  4]
 [ 7 23]]
Acc train:  1.0
Acc test :  0.7922950819672131
AUC train:  1.0
AUC test :  0.894585268941037</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Neural
</summary>
<section>
</section>
<section id="loading-and-pre-processing-13" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-13">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, roc_auc_score, confusion_matrix <span class="co">#model evaluation</span></span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-18"><a href="#cb171-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb171-19"><a href="#cb171-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb171-20"><a href="#cb171-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/heart.csv"</span>)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="co"># heart.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age         0
sex         0
cp          0
trestbps    0
chol        0
fbs         0
restecg     0
thalach     0
exang       0
oldpeak     0
slope       0
ca          0
thal        0
target      0
dtype: int64
(303, 14)</code></pre>
</div>
</div>
<p>There arenâ€™t any missing values here, but weâ€™ll go through the motions anyway (it wonâ€™t negatively impact our analysis).</p>
<div class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also create dummy variables for our categorical/ordinal variables if they have more than 2 (0/1) categories.</p>
<div class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"cp"</span>,</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="st">"trestbps"</span>,<span class="st">"chol"</span>,<span class="st">"fbs"</span>,<span class="st">"restecg"</span>,</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="st">"thalach"</span>,<span class="st">"exang"</span>,<span class="st">"oldpeak"</span>,<span class="st">"slope"</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>,<span class="st">"ca"</span>,<span class="st">"thal"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> heart[predictors] <span class="co"># predictors/input</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> heart[<span class="st">"target"</span>] <span class="co"># outcome/output</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span> [<span class="st">"cp"</span>, <span class="st">"slope"</span>, <span class="st">"thal"</span>], drop_first <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our continuous inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those. Because weâ€™re going to do hyperparameter tuning to choose <code>k</code> (the number of neighbors to look at), weâ€™ll create a z-score object using <code>make_column_transformer</code>. This function takes in two <em>very</em> important arguments.</p>
<ul>
<li>first, it takes in a <em>tuple</em> that contains both the transformation we want to apply (here: <code>StandardScaler()</code>), and the columns we want to transform with that transformation (here: <code>continuous</code>)</li>
<li><code>remainder = "passthrough"</code> which tells python not to drop/remove all the non-z-scored columns</li>
</ul>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> make_column_transformer((StandardScaler(), continuous),</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>remainder <span class="op">=</span> <span class="st">"passthrough"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-13" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-13">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model and put it and our <code>z</code> object into a pipeline, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. <em>However</em>, because we want to do hyperparameter tuning via <code>GridSearchCV</code>, weâ€™ll need to first create a grid search object, and tell it which hyperparameters to try (these hyperparameter options are stored in the dictionary <code>msl</code>).</p>
<div class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> DecisionTreeClassifier() <span class="co"># create empty model</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pipeline</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> make_pipeline(z,dt)</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="co"># hyperparams</span></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a>msl <span class="op">=</span> {<span class="st">"decisiontreeclassifier__min_samples_leaf"</span>: <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">50</span>)}</span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="co"># grid</span></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(pipe, msl, scoring <span class="op">=</span> <span class="st">"accuracy"</span>, cv <span class="op">=</span> <span class="dv">5</span>, refit <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train) <span class="co"># fit model (aka find the best parameters)</span></span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a><span class="co"># what k did it choose??</span></span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"min samples leaf chosen:"</span>, grid.best_estimator_.get_params()[<span class="st">"decisiontreeclassifier__min_samples_leaf"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>min samples leaf chosen: 1</code></pre>
</div>
</div>
</section>
<section id="evaluate-the-model-13" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-13">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦)</p>
<p>All of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>pred_train <span class="op">=</span> grid.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>pred_train_proba <span class="op">=</span> grid.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Acc: "</span>, accuracy_score(y_train,pred_train))</span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train AUC: "</span>, roc_auc_score(y_train,pred_train_proba))</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train CM : "</span>, confusion_matrix(y_train,pred_train))</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>pred_test <span class="op">=</span> grid.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>pred_test_proba <span class="op">=</span> grid.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test Acc : "</span>, accuracy_score(y_test,pred_test))</span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test AUC : "</span>, roc_auc_score(y_test,pred_test_proba))</span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test CM  : "</span>, confusion_matrix(y_test,pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train Acc:  1.0
Train AUC:  1.0
Train CM :  [[29  0]
 [ 0 32]]
Test Acc :  0.743801652892562
Test AUC :  0.7412568117541559
Test CM  :  [[ 78  31]
 [ 31 102]]</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll create a z-score object. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those, the rest will be left alone because we set <code>remainder = "passthrough"</code>.</p>
<section id="model-building-and-evaluation-12" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-12">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model and put it and our <code>z</code> object into a pipeline, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. <em>However</em>, because we want to do hyperparameter tuning via <code>GridSearchCV</code>, weâ€™ll need to first create a grid search object, and tell it which hyperparameters to try (these hyperparameter options are stored in the dictionary <code>ks</code>).</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦). Because weâ€™re doing K-Fold CV, weâ€™ll have K different Accuracies, ROC AUCs, and Confusion Matrices for the train/test set. So, we store all K of them in lists (<code>acc_train</code>, <code>acc_test</code>â€¦etc), and print out the confusion matrices for each model.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>acc_train <span class="op">=</span> []</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>acc_test  <span class="op">=</span> []</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>auc_train <span class="op">=</span> []</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>auc_test  <span class="op">=</span> []</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>    continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> make_column_transformer((StandardScaler(), continuous),</span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">"passthrough"</span>)</span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># model</span></span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> DecisionTreeClassifier() <span class="co"># create empty model</span></span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-27"><a href="#cb183-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pipeline</span></span>
<span id="cb183-28"><a href="#cb183-28" aria-hidden="true" tabindex="-1"></a>    pipe <span class="op">=</span> make_pipeline(z,dt)</span>
<span id="cb183-29"><a href="#cb183-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-30"><a href="#cb183-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># hyperparams</span></span>
<span id="cb183-31"><a href="#cb183-31" aria-hidden="true" tabindex="-1"></a>    msl <span class="op">=</span> {<span class="st">"decisiontreeclassifier__min_samples_leaf"</span>: <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>)}</span>
<span id="cb183-32"><a href="#cb183-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-33"><a href="#cb183-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grid</span></span>
<span id="cb183-34"><a href="#cb183-34" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> GridSearchCV(pipe, msl, scoring <span class="op">=</span> <span class="st">"accuracy"</span>, cv <span class="op">=</span> <span class="dv">5</span>, refit <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb183-35"><a href="#cb183-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-36"><a href="#cb183-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-37"><a href="#cb183-37" aria-hidden="true" tabindex="-1"></a>    grid.fit(X_train, y_train) <span class="co"># fit model (aka find the best parameters)</span></span>
<span id="cb183-38"><a href="#cb183-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-39"><a href="#cb183-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># what k did it choose??</span></span>
<span id="cb183-40"><a href="#cb183-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"min samples leaf chosen: "</span>, grid.best_estimator_.get_params()[<span class="st">"decisiontreeclassifier__min_samples_leaf"</span>])</span>
<span id="cb183-41"><a href="#cb183-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-42"><a href="#cb183-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb183-43"><a href="#cb183-43" aria-hidden="true" tabindex="-1"></a>    pred_train <span class="op">=</span> grid.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb183-44"><a href="#cb183-44" aria-hidden="true" tabindex="-1"></a>    pred_train_proba <span class="op">=</span> grid.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb183-45"><a href="#cb183-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-46"><a href="#cb183-46" aria-hidden="true" tabindex="-1"></a>    pred_test <span class="op">=</span> grid.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb183-47"><a href="#cb183-47" aria-hidden="true" tabindex="-1"></a>    pred_test_proba <span class="op">=</span> grid.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb183-48"><a href="#cb183-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-49"><a href="#cb183-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># acc</span></span>
<span id="cb183-50"><a href="#cb183-50" aria-hidden="true" tabindex="-1"></a>    acc_train.append(accuracy_score(y_train, pred_train))</span>
<span id="cb183-51"><a href="#cb183-51" aria-hidden="true" tabindex="-1"></a>    acc_test.append(accuracy_score(y_test, pred_test))</span>
<span id="cb183-52"><a href="#cb183-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-53"><a href="#cb183-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># auc</span></span>
<span id="cb183-54"><a href="#cb183-54" aria-hidden="true" tabindex="-1"></a>    auc_train.append(roc_auc_score(y_train, pred_train_proba))</span>
<span id="cb183-55"><a href="#cb183-55" aria-hidden="true" tabindex="-1"></a>    auc_test.append(roc_auc_score(y_test, pred_test_proba))</span>
<span id="cb183-56"><a href="#cb183-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb183-57"><a href="#cb183-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cm</span></span>
<span id="cb183-58"><a href="#cb183-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_train, pred_train))</span>
<span id="cb183-59"><a href="#cb183-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_test, pred_test))</span>
<span id="cb183-60"><a href="#cb183-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-61"><a href="#cb183-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc train: "</span>, np.mean(acc_train))</span>
<span id="cb183-62"><a href="#cb183-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc test : "</span>, np.mean(acc_test))   </span>
<span id="cb183-63"><a href="#cb183-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-64"><a href="#cb183-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC train: "</span>, np.mean(auc_train))</span>
<span id="cb183-65"><a href="#cb183-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC test : "</span>, np.mean(auc_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>min samples leaf chosen:  10
[[ 93  23]
 [ 16 110]]
[[14  8]
 [ 7 32]]
min samples leaf chosen:  7
[[ 89  16]
 [ 10 127]]
[[21 12]
 [ 6 22]]
min samples leaf chosen:  13
[[ 90  23]
 [ 15 114]]
[[16  9]
 [ 2 34]]
min samples leaf chosen:  10
[[ 86  22]
 [ 12 123]]
[[22  8]
 [ 3 27]]
min samples leaf chosen:  5
[[ 93  17]
 [ 14 119]]
[[23  5]
 [12 20]]
Acc train:  0.86137809067102
Acc test :  0.7624043715846994
AUC train:  0.9395843231686856
AUC test :  0.8401775897713397</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Random Forest
</summary>
<section>
</section>
<section id="loading-and-pre-processing-14" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-14">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, roc_auc_score, confusion_matrix <span class="co">#model evaluation</span></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/heart.csv"</span>)</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="co"># heart.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age         0
sex         0
cp          0
trestbps    0
chol        0
fbs         0
restecg     0
thalach     0
exang       0
oldpeak     0
slope       0
ca          0
thal        0
target      0
dtype: int64
(303, 14)</code></pre>
</div>
</div>
<p>There arenâ€™t any missing values here, but weâ€™ll go through the motions anyway (it wonâ€™t negatively impact our analysis).</p>
<div class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also create dummy variables for our categorical/ordinal variables if they have more than 2 (0/1) categories.</p>
<div class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"cp"</span>,</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="st">"trestbps"</span>,<span class="st">"chol"</span>,<span class="st">"fbs"</span>,<span class="st">"restecg"</span>,</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="st">"thalach"</span>,<span class="st">"exang"</span>,<span class="st">"oldpeak"</span>,<span class="st">"slope"</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>,<span class="st">"ca"</span>,<span class="st">"thal"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> heart[predictors] <span class="co"># predictors/input</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> heart[<span class="st">"target"</span>] <span class="co"># outcome/output</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy</span></span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span> [<span class="st">"cp"</span>, <span class="st">"slope"</span>, <span class="st">"thal"</span>], drop_first <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those.</p>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-14" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-14">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier() <span class="co"># create empty model</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train) <span class="co"># fit model (aka find the best parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1252">
<style>#sk-container-id-88 {color: black;background-color: white;}#sk-container-id-88 pre{padding: 0;}#sk-container-id-88 div.sk-toggleable {background-color: white;}#sk-container-id-88 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-88 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-88 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-88 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-88 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-88 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-88 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-88 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-88 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-88 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-88 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-88 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-88 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-88 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-88 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-88 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-88 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-88 div.sk-item {position: relative;z-index: 1;}#sk-container-id-88 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-88 div.sk-item::before, #sk-container-id-88 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-88 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-88 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-88 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-88 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-88 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-88 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-88 div.sk-label-container {text-align: center;}#sk-container-id-88 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-88 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-88" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-88" type="checkbox" checked=""><label for="sk-estimator-id-88" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-14" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-14">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦)</p>
<p>All of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>pred_train <span class="op">=</span> rf.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>pred_train_proba <span class="op">=</span> rf.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Acc: "</span>, accuracy_score(y_train,pred_train))</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train AUC: "</span>, roc_auc_score(y_train,pred_train_proba))</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train CM : "</span>, confusion_matrix(y_train,pred_train))</span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a>pred_test <span class="op">=</span> rf.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>pred_test_proba <span class="op">=</span> rf.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test Acc : "</span>, accuracy_score(y_test,pred_test))</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test AUC : "</span>, roc_auc_score(y_test,pred_test_proba))</span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test CM  : "</span>, confusion_matrix(y_test,pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train Acc:  1.0
Train AUC:  1.0
Train CM :  [[28  0]
 [ 0 33]]
Test Acc :  0.7892561983471075
Test AUC :  0.8464187327823691
Test CM  :  [[ 88  22]
 [ 29 103]]</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those.</p>
<section id="model-building-and-evaluation-13" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-13">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦). Because weâ€™re doing K-Fold CV, weâ€™ll have K different Accuracies, ROC AUCs, and Confusion Matrices for the train/test set. So, we store all K of them in lists (<code>acc_train</code>, <code>acc_test</code>â€¦etc), and print out the confusion matrices for each model.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>acc_train <span class="op">=</span> []</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>acc_test  <span class="op">=</span> []</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>auc_train <span class="op">=</span> []</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>auc_test  <span class="op">=</span> []</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb196-23"><a href="#cb196-23" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb196-24"><a href="#cb196-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb196-25"><a href="#cb196-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create empty model</span></span>
<span id="cb196-26"><a href="#cb196-26" aria-hidden="true" tabindex="-1"></a>    rf <span class="op">=</span> RandomForestClassifier()</span>
<span id="cb196-27"><a href="#cb196-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-28"><a href="#cb196-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb196-29"><a href="#cb196-29" aria-hidden="true" tabindex="-1"></a>    rf.fit(X_train,y_train)</span>
<span id="cb196-30"><a href="#cb196-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb196-31"><a href="#cb196-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb196-32"><a href="#cb196-32" aria-hidden="true" tabindex="-1"></a>    pred_train <span class="op">=</span> rf.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb196-33"><a href="#cb196-33" aria-hidden="true" tabindex="-1"></a>    pred_train_proba <span class="op">=</span> rf.predict_proba(X_train)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_train</span></span>
<span id="cb196-34"><a href="#cb196-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-35"><a href="#cb196-35" aria-hidden="true" tabindex="-1"></a>    pred_test <span class="op">=</span> rf.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb196-36"><a href="#cb196-36" aria-hidden="true" tabindex="-1"></a>    pred_test_proba <span class="op">=</span> rf.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb196-37"><a href="#cb196-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb196-38"><a href="#cb196-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># acc</span></span>
<span id="cb196-39"><a href="#cb196-39" aria-hidden="true" tabindex="-1"></a>    acc_train.append(accuracy_score(y_train, pred_train))</span>
<span id="cb196-40"><a href="#cb196-40" aria-hidden="true" tabindex="-1"></a>    acc_test.append(accuracy_score(y_test, pred_test))</span>
<span id="cb196-41"><a href="#cb196-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb196-42"><a href="#cb196-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># auc</span></span>
<span id="cb196-43"><a href="#cb196-43" aria-hidden="true" tabindex="-1"></a>    auc_train.append(roc_auc_score(y_train, pred_train_proba))</span>
<span id="cb196-44"><a href="#cb196-44" aria-hidden="true" tabindex="-1"></a>    auc_test.append(roc_auc_score(y_test, pred_test_proba))</span>
<span id="cb196-45"><a href="#cb196-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb196-46"><a href="#cb196-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cm</span></span>
<span id="cb196-47"><a href="#cb196-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_train, pred_train))</span>
<span id="cb196-48"><a href="#cb196-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_test, pred_test))</span>
<span id="cb196-49"><a href="#cb196-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-50"><a href="#cb196-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc train: "</span>, np.mean(acc_train))</span>
<span id="cb196-51"><a href="#cb196-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc test : "</span>, np.mean(acc_test))   </span>
<span id="cb196-52"><a href="#cb196-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-53"><a href="#cb196-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC train: "</span>, np.mean(auc_train))</span>
<span id="cb196-54"><a href="#cb196-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC test : "</span>, np.mean(auc_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[109   0]
 [  0 133]]
[[21  8]
 [ 6 26]]
[[105   0]
 [  0 137]]
[[28  5]
 [ 6 22]]
[[111   0]
 [  0 131]]
[[22  5]
 [ 7 27]]
[[115   0]
 [  0 128]]
[[17  6]
 [ 6 31]]
[[112   0]
 [  0 131]]
[[22  4]
 [ 5 29]]
Acc train:  1.0
Acc test :  0.8086885245901639
AUC train:  1.0
AUC test :  0.8849785780120246</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Neural Network
</summary>
<section>
</section>
<section id="loading-and-pre-processing-15" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-15">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow.keras <span class="im">as</span> kb</span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, roc_auc_score, confusion_matrix <span class="co">#model evaluation</span></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/heart.csv"</span>)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="co"># heart.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heart.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age         0
sex         0
cp          0
trestbps    0
chol        0
fbs         0
restecg     0
thalach     0
exang       0
oldpeak     0
slope       0
ca          0
thal        0
target      0
dtype: int64
(303, 14)</code></pre>
</div>
</div>
<p>There arenâ€™t any missing values here, but weâ€™ll go through the motions anyway (it wonâ€™t negatively impact our analysis).</p>
<div class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>heart <span class="op">=</span> heart.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also create dummy variables for our categorical/ordinal variables if they have more than 2 (0/1) categories.</p>
<div class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"age"</span>,<span class="st">"sex"</span>,<span class="st">"cp"</span>,</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="st">"trestbps"</span>,<span class="st">"chol"</span>,<span class="st">"fbs"</span>,<span class="st">"restecg"</span>,</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="st">"thalach"</span>,<span class="st">"exang"</span>,<span class="st">"oldpeak"</span>,<span class="st">"slope"</span></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>,<span class="st">"ca"</span>,<span class="st">"thal"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> heart[predictors] <span class="co"># predictors/input</span></span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> heart[<span class="st">"target"</span>] <span class="co"># outcome/output</span></span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy</span></span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span> [<span class="st">"cp"</span>, <span class="st">"slope"</span>, <span class="st">"thal"</span>], drop_first <span class="op">=</span> <span class="va">True</span>, dtype <span class="op">=</span> <span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those.</p>
<div class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-15" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-15">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be.</p>
<div class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co">#structure of the model</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> kb.Sequential([</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>    kb.layers.Dense(<span class="dv">1</span>, input_shape <span class="op">=</span>[<span class="dv">18</span>], activation <span class="op">=</span> <span class="st">"sigmoid"</span>), <span class="co">#input</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="co">#how to train the model</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">"binary_crossentropy"</span>,</span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>              optimizer <span class="op">=</span> kb.optimizers.SGD())</span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a><span class="co">#fit the model (same as SKlearn)</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>model.fit(X_train,y_train, epochs <span class="op">=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 0.83942/2 [==============================] - 0s 3ms/step - loss: 0.8409
Epoch 2/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 0.85552/2 [==============================] - 0s 3ms/step - loss: 0.8303
Epoch 3/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 0.87482/2 [==============================] - 0s 3ms/step - loss: 0.8200
Epoch 4/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 0.82282/2 [==============================] - 0s 3ms/step - loss: 0.8099
Epoch 5/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 0.77392/2 [==============================] - 0s 3ms/step - loss: 0.8000</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1262">
<pre><code>&lt;keras.callbacks.History at 0x7fe93030fe80&gt;</code></pre>
</div>
</div>
</section>
<section id="evaluate-the-model-15" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-15">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦)</p>
<p>All of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>pred_train <span class="op">=</span> model.predict(X_train) <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="co"># make predictions for data in X_train</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>pred_train_proba <span class="op">=</span> model.predict(X_train)<span class="co"># make probabilities for data in X_train</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train Acc: "</span>, accuracy_score(y_train,pred_train))</span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train AUC: "</span>, roc_auc_score(y_train,pred_train_proba))</span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train CM : "</span>, confusion_matrix(y_train,pred_train))</span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a>pred_test <span class="op">=</span> model.predict(X_test) <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="co"># make predictions for data in X_test</span></span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a>pred_test_proba <span class="op">=</span> model.predict(X_test) <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-16"><a href="#cb209-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-17"><a href="#cb209-17" aria-hidden="true" tabindex="-1"></a><span class="co"># acc and auc</span></span>
<span id="cb209-18"><a href="#cb209-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test Acc : "</span>, accuracy_score(y_test,pred_test))</span>
<span id="cb209-19"><a href="#cb209-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test AUC : "</span>, roc_auc_score(y_test,pred_test_proba))</span>
<span id="cb209-20"><a href="#cb209-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-21"><a href="#cb209-21" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb209-22"><a href="#cb209-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test CM  : "</span>, confusion_matrix(y_test,pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 3ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
Train Acc:  0.45901639344262296
Train AUC:  0.41594827586206895
Train CM :  [[16 16]
 [17 12]]
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 1ms/step
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 1ms/step
Test Acc :  0.38016528925619836
Test AUC :  0.3498196448390677
Test CM  :  [[44 62]
 [88 48]]</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. Only <code>age</code>, <code>testbps</code>, <code>chol</code>, <code>thalach</code> and <code>oldpeak</code> are continuous, so weâ€™ll z score those.</p>
<section id="model-building-and-evaluation-14" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-14">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Now that we have a fitted model, we need to check how well it performs. For a categorical outcome, we often check the Accuracy, ROC AUC, and confusion matrix (among othersâ€¦). Because weâ€™re doing K-Fold CV, weâ€™ll have K different Accuracies, ROC AUCs, and Confusion Matrices for the train/test set. So, we store all K of them in lists (<code>acc_train</code>, <code>acc_test</code>â€¦etc), and print out the confusion matrices for each model.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, <code>target</code>: whether or not someone had a cardiac event) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="158">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>acc_train <span class="op">=</span> []</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>acc_test  <span class="op">=</span> []</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>auc_train <span class="op">=</span> []</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>auc_test  <span class="op">=</span> []</span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"age"</span>, <span class="st">"trestbps"</span>,<span class="st">"chol"</span>, <span class="st">"thalach"</span>,<span class="st">"oldpeak"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb211-19"><a href="#cb211-19" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb211-20"><a href="#cb211-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-21"><a href="#cb211-21" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb211-22"><a href="#cb211-22" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb211-23"><a href="#cb211-23" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb211-24"><a href="#cb211-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-25"><a href="#cb211-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#structure of the model</span></span>
<span id="cb211-26"><a href="#cb211-26" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> kb.Sequential([</span>
<span id="cb211-27"><a href="#cb211-27" aria-hidden="true" tabindex="-1"></a>        kb.layers.Dense(<span class="dv">1</span>, input_shape <span class="op">=</span>[<span class="dv">18</span>], activation <span class="op">=</span> <span class="st">"sigmoid"</span>), <span class="co">#input</span></span>
<span id="cb211-28"><a href="#cb211-28" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb211-29"><a href="#cb211-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-30"><a href="#cb211-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#how to train the model</span></span>
<span id="cb211-31"><a href="#cb211-31" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">"binary_crossentropy"</span>,</span>
<span id="cb211-32"><a href="#cb211-32" aria-hidden="true" tabindex="-1"></a>                optimizer <span class="op">=</span> kb.optimizers.SGD())</span>
<span id="cb211-33"><a href="#cb211-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-34"><a href="#cb211-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#fit the model (same as SKlearn)</span></span>
<span id="cb211-35"><a href="#cb211-35" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train,y_train, epochs <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb211-36"><a href="#cb211-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-37"><a href="#cb211-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb211-38"><a href="#cb211-38" aria-hidden="true" tabindex="-1"></a>    pred_train <span class="op">=</span> model.predict(X_train) <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="co"># make predictions for data in X_train</span></span>
<span id="cb211-39"><a href="#cb211-39" aria-hidden="true" tabindex="-1"></a>    pred_train_proba <span class="op">=</span> model.predict(X_train)<span class="co"># make probabilities for data in X_train</span></span>
<span id="cb211-40"><a href="#cb211-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-41"><a href="#cb211-41" aria-hidden="true" tabindex="-1"></a>    pred_test <span class="op">=</span> model.predict(X_test) <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="co"># make predictions for data in X_test</span></span>
<span id="cb211-42"><a href="#cb211-42" aria-hidden="true" tabindex="-1"></a>    pred_test_proba <span class="op">=</span> model.predict(X_test) <span class="co"># make probabilities for data in X_test</span></span>
<span id="cb211-43"><a href="#cb211-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-44"><a href="#cb211-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># acc</span></span>
<span id="cb211-45"><a href="#cb211-45" aria-hidden="true" tabindex="-1"></a>    acc_train.append(accuracy_score(y_train, pred_train))</span>
<span id="cb211-46"><a href="#cb211-46" aria-hidden="true" tabindex="-1"></a>    acc_test.append(accuracy_score(y_test, pred_test))</span>
<span id="cb211-47"><a href="#cb211-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-48"><a href="#cb211-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># auc</span></span>
<span id="cb211-49"><a href="#cb211-49" aria-hidden="true" tabindex="-1"></a>    auc_train.append(roc_auc_score(y_train, pred_train_proba))</span>
<span id="cb211-50"><a href="#cb211-50" aria-hidden="true" tabindex="-1"></a>    auc_test.append(roc_auc_score(y_test, pred_test_proba))</span>
<span id="cb211-51"><a href="#cb211-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-52"><a href="#cb211-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cm</span></span>
<span id="cb211-53"><a href="#cb211-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_train, pred_train))</span>
<span id="cb211-54"><a href="#cb211-54" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(confusion_matrix(y_test, pred_test))</span>
<span id="cb211-55"><a href="#cb211-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-56"><a href="#cb211-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc train: "</span>, np.mean(acc_train))</span>
<span id="cb211-57"><a href="#cb211-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Acc test : "</span>, np.mean(acc_test))   </span>
<span id="cb211-58"><a href="#cb211-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-59"><a href="#cb211-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC train: "</span>, np.mean(auc_train))</span>
<span id="cb211-60"><a href="#cb211-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUC test : "</span>, np.mean(auc_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/5
1/8 [==&gt;...........................] - ETA: 2s - loss: 0.56948/8 [==============================] - 0s 1ms/step - loss: 0.6705
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.66708/8 [==============================] - 0s 1ms/step - loss: 0.6588
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.72768/8 [==============================] - 0s 2ms/step - loss: 0.6477
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.71918/8 [==============================] - 0s 2ms/step - loss: 0.6379
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.51768/8 [==============================] - 0s 1ms/step - loss: 0.6283
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 950us/step
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 1ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
[[ 62  44]
 [ 31 105]]
[[16 16]
 [ 7 22]]
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 2s - loss: 0.74798/8 [==============================] - 0s 1ms/step - loss: 0.6295
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.69468/8 [==============================] - 0s 1ms/step - loss: 0.6165
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.64208/8 [==============================] - 0s 2ms/step - loss: 0.6045
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.49808/8 [==============================] - 0s 1ms/step - loss: 0.5935
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.59018/8 [==============================] - 0s 1ms/step - loss: 0.5832
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 981us/step
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 1ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
[[ 52  60]
 [ 19 111]]
[[12 14]
 [ 8 27]]
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 2s - loss: 1.05388/8 [==============================] - 0s 2ms/step - loss: 0.9987
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.94208/8 [==============================] - 0s 1ms/step - loss: 0.9637
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.96468/8 [==============================] - 0s 1ms/step - loss: 0.9310
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.94858/8 [==============================] - 0s 1ms/step - loss: 0.9004
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.90048/8 [==============================] - 0s 1ms/step - loss: 0.8722
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 1ms/step
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 887us/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 1ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
[[41 70]
 [83 48]]
[[ 9 18]
 [20 14]]
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 1s - loss: 0.66708/8 [==============================] - 0s 2ms/step - loss: 0.6499
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.71128/8 [==============================] - 0s 1ms/step - loss: 0.6414
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.69428/8 [==============================] - 0s 1ms/step - loss: 0.6331
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.54668/8 [==============================] - 0s 1ms/step - loss: 0.6255
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.66638/8 [==============================] - 0s 2ms/step - loss: 0.6186
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 1ms/step
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 860us/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 3ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
[[88 24]
 [61 70]]
[[19  7]
 [14 20]]
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 2s - loss: 0.78868/8 [==============================] - 0s 1ms/step - loss: 0.8543
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.84218/8 [==============================] - 0s 1ms/step - loss: 0.8269
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.85938/8 [==============================] - 0s 1ms/step - loss: 0.8019
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.77908/8 [==============================] - 0s 1ms/step - loss: 0.7787
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 0.78398/8 [==============================] - 0s 1ms/step - loss: 0.7574
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 894us/step
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 907us/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 1ms/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
[[63 48]
 [79 53]]
[[18  9]
 [19 14]]
Acc train:  0.5717953950277183
Acc test :  0.564535519125683
AUC train:  0.6080980028298953
AUC test :  0.5969592131255418</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
</section>


<section id="unsupervised-machine-learning" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Unsupervised Machine Learning</h1>
<section id="clustering" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="clustering"><span class="header-section-number">3.1</span> Clustering</h2>
<section id="kmeans" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="kmeans"><span class="header-section-number">3.1.1</span> KMeans</h3>
</section>
<section id="gaussian-mixture-model" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="gaussian-mixture-model"><span class="header-section-number">3.1.2</span> Gaussian Mixture Model</h3>
</section>
<section id="dbscan" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="dbscan"><span class="header-section-number">3.1.3</span> DBSCAN</h3>
</section>
<section id="hierarchical-agglomerative-clustering" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4" class="anchored" data-anchor-id="hierarchical-agglomerative-clustering"><span class="header-section-number">3.1.4</span> Hierarchical Agglomerative Clustering</h3>
</section>
</section>
<section id="dimensionality-reduction" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="dimensionality-reduction"><span class="header-section-number">3.2</span> Dimensionality Reduction</h2>
<section id="pca" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="pca"><span class="header-section-number">3.2.1</span> PCA</h3>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>