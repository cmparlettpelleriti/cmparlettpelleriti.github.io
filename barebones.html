<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.427">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Chelsea Parlett-Pelleriti">

<title>Bare Bones Model Examples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="barebones_files/libs/clipboard/clipboard.min.js"></script>
<script src="barebones_files/libs/quarto-html/quarto.js"></script>
<script src="barebones_files/libs/quarto-html/popper.min.js"></script>
<script src="barebones_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="barebones_files/libs/quarto-html/anchor.min.js"></script>
<link href="barebones_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="barebones_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="barebones_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="barebones_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="barebones_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a></li>
  <li><a href="#supervised-machine-learning" id="toc-supervised-machine-learning" class="nav-link" data-scroll-target="#supervised-machine-learning"><span class="header-section-number">2</span> Supervised Machine Learning</a>
  <ul class="collapse">
  <li><a href="#regression-continuous-outcome" id="toc-regression-continuous-outcome" class="nav-link" data-scroll-target="#regression-continuous-outcome"><span class="header-section-number">2.1</span> Regression (Continuous Outcome)</a></li>
  <li><a href="#classification-categorical-outcome" id="toc-classification-categorical-outcome" class="nav-link" data-scroll-target="#classification-categorical-outcome"><span class="header-section-number">2.2</span> Classification (Categorical Outcome)</a>
  <ul class="collapse">
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">2.2.1</span> Logistic Regression</a></li>
  <li><a href="#knn" id="toc-knn" class="nav-link" data-scroll-target="#knn"><span class="header-section-number">2.2.2</span> KNN</a></li>
  <li><a href="#naive-bayes" id="toc-naive-bayes" class="nav-link" data-scroll-target="#naive-bayes"><span class="header-section-number">2.2.3</span> Naive Bayes</a></li>
  <li><a href="#decision-trees" id="toc-decision-trees" class="nav-link" data-scroll-target="#decision-trees"><span class="header-section-number">2.2.4</span> Decision Trees</a></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest"><span class="header-section-number">2.2.5</span> Random Forest</a></li>
  <li><a href="#neural-network" id="toc-neural-network" class="nav-link" data-scroll-target="#neural-network"><span class="header-section-number">2.2.6</span> Neural Network</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#unsupervised-machine-learning" id="toc-unsupervised-machine-learning" class="nav-link" data-scroll-target="#unsupervised-machine-learning"><span class="header-section-number">3</span> Unsupervised Machine Learning</a>
  <ul class="collapse">
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering"><span class="header-section-number">3.1</span> Clustering</a>
  <ul class="collapse">
  <li><a href="#kmeans" id="toc-kmeans" class="nav-link" data-scroll-target="#kmeans"><span class="header-section-number">3.1.1</span> KMeans</a></li>
  <li><a href="#gaussian-mixture-model" id="toc-gaussian-mixture-model" class="nav-link" data-scroll-target="#gaussian-mixture-model"><span class="header-section-number">3.1.2</span> Gaussian Mixture Model</a></li>
  <li><a href="#dbscan" id="toc-dbscan" class="nav-link" data-scroll-target="#dbscan"><span class="header-section-number">3.1.3</span> DBSCAN</a></li>
  <li><a href="#hierarchical-agglomerative-clustering" id="toc-hierarchical-agglomerative-clustering" class="nav-link" data-scroll-target="#hierarchical-agglomerative-clustering"><span class="header-section-number">3.1.4</span> Hierarchical Agglomerative Clustering</a></li>
  </ul></li>
  <li><a href="#dimensionality-reduction" id="toc-dimensionality-reduction" class="nav-link" data-scroll-target="#dimensionality-reduction"><span class="header-section-number">3.2</span> Dimensionality Reduction</a>
  <ul class="collapse">
  <li><a href="#pca" id="toc-pca" class="nav-link" data-scroll-target="#pca"><span class="header-section-number">3.2.1</span> PCA</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bare Bones Model Examples</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Chelsea Parlett-Pelleriti </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Overview</h1>
<p>The following sections provide annotated bare-bones examples of how to run each algorithm we learn in class. This only includes data loading, pre-procesing, model building, and basic model evaluation and <strong>does not</strong> include all the extras we learn in class (like plotting, hyper-parameter tuning..etc)/</p>
</section>
<section id="supervised-machine-learning" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Supervised Machine Learning</h1>
<p>In supervised ML the general workflow is:</p>
<ul>
<li>Create X and y (includes pre-processing, model validationâ€¦etc)</li>
<li>Create empty model</li>
<li>.fit()</li>
<li>.predict()</li>
<li>Evaluate</li>
</ul>
<section id="regression-continuous-outcome" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="regression-continuous-outcome"><span class="header-section-number">2.1</span> Regression (Continuous Outcome)</h2>
<details>
<summary>
Linear Regression (No Model Validation)
</summary>
<section id="loading-and-pre-processing" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression <span class="co"># Linear Regression Model</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>z.fit(X[continuous]) <span class="co"># z score all predictors that are continuous/interval</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>X[continuous] <span class="op">=</span> z.transform(X[continuous]) <span class="co"># z score all predictors that are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="build-and-fit-the-model" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>LR_Model <span class="op">=</span> LinearRegression() <span class="co"># empty model</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>LR_Model.fit(X, y) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>price_pred <span class="op">=</span> LR_Model.predict(X) <span class="co"># make predictions for data in X</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE: "</span>, mean_squared_error(y,price_pred))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE: "</span>, mean_absolute_error(y,price_pred))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 : "</span>, r2_score(y,price_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE:  10.410351383442405
MAE:  2.1524134686888465
R2 :  0.9221000651451909</code></pre>
</div>
</div>
</section></details>
<details>
<summary>
Linear Regression
</summary>
<section>
</section>
<section id="loading-and-pre-processing-1" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-1">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression <span class="co"># Linear Regression Model</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-1" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-1">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>LR_Model <span class="op">=</span> LinearRegression() <span class="co"># empty model</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>LR_Model.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-1" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-1">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> LR_Model.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> LR_Model.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  3.0048357193927426
Train MAE:  1.3260662283788245
Train R2 :  0.8846190641925951
Test MSE :  25.39705197694551
Test MAE :  2.320091965839489
Test R2  :  0.8407719884652993</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    LR_Model <span class="op">=</span> LinearRegression() <span class="co"># empty model</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    LR_Model.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> LR_Model.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> LR_Model.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  10.23792224385419
MSE test :  12.129668779749553
MAE train:  2.1480335384912115
MAE test :  2.212416787248441
R2 train :  0.9221786079192222
R2 test  :  0.874033914265226</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
K-Nearest Neighbors Regression
</summary>
<section>
</section>
<section id="loading-and-pre-processing-2" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-2">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor <span class="co"># KNN Regression Model</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-2" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-2">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>KNN <span class="op">=</span> KNeighborsRegressor() <span class="co"># empty model</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>KNN.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsRegressor()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">KNeighborsRegressor</label><div class="sk-toggleable__content"><pre>KNeighborsRegressor()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-2" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-2">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> KNN.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> KNN.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  20.651055096774186
Train MAE:  2.503354838709678
Train R2 :  0.6502174737464006
Test MSE :  91.47932943548383
Test MAE :  3.2026048387096773
Test R2  :  0.39907565133379785</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-1" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-1">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    KNN <span class="op">=</span> KNeighborsRegressor() <span class="co"># empty model</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    KNN.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> KNN.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> KNN.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  19.436069958064508
MSE test :  29.791680438709676
MAE train:  1.9224403225806452
MAE test :  2.376425806451613
R2 train :  0.8532226060219799
R2 test  :  0.7894958539309404</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Regression Trees
</summary>
<section>
</section>
<section id="loading-and-pre-processing-3" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-3">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor <span class="co"># Regression Tree Model</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-3" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-3">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> DecisionTreeRegressor() <span class="co"># empty model</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>tree.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>DecisionTreeRegressor()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked=""><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">DecisionTreeRegressor</label><div class="sk-toggleable__content"><pre>DecisionTreeRegressor()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-3" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-3">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> tree.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> tree.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  0.0
Train MAE:  0.0
Train R2 :  1.0
Test MSE :  21.98198629032258
Test MAE :  2.545564516129032
Test R2  :  0.7012525802311955</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-2" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-2">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> DecisionTreeRegressor() <span class="co"># empty model</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>    tree.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> tree.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> tree.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  1.032258064516131e-05
MSE test :  26.955008387096775
MAE train:  0.00025806451612906116
MAE test :  2.177032258064516
R2 train :  0.999999915986014
R2 test  :  0.7666285060366248</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Random Forest Regression
</summary>
<section>
</section>
<section id="loading-and-pre-processing-4" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-4">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor <span class="co"># Regression RF Model</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-4" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-4">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> RandomForestRegressor() <span class="co"># empty model</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>tree.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<style>#sk-container-id-5 {color: black;background-color: white;}#sk-container-id-5 pre{padding: 0;}#sk-container-id-5 div.sk-toggleable {background-color: white;}#sk-container-id-5 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-5 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-5 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-5 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-5 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-5 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-5 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-5 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-5 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-5 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-5 div.sk-item {position: relative;z-index: 1;}#sk-container-id-5 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-5 div.sk-item::before, #sk-container-id-5 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-5 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-5 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-5 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-5 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-5 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-5 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-5 div.sk-label-container {text-align: center;}#sk-container-id-5 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-5 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestRegressor()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" checked=""><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-4" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-4">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> tree.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> tree.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  35.62725702080642
Train MAE:  1.3511564516129009
Train R2 :  0.8736873132577225
Test MSE :  18.389818194354845
Test MAE :  2.130002419354838
Test R2  :  0.8093793487083816</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-3" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-3">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>    tree <span class="op">=</span> RandomForestRegressor() <span class="co"># empty model</span></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>    tree.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> tree.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> tree.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  3.3437224387440736
MSE test :  20.27425137277493
MAE train:  0.6971421236559122
MAE test :  1.8605657419354835
R2 train :  0.975478649562984
R2 test  :  0.8617331467701318</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
LASSO
</summary>
<section>
</section>
<section id="loading-and-pre-processing-5" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-5">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Lasso <span class="co"># Lasso Model</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-5" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-5">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>lasso <span class="op">=</span> Lasso() <span class="co"># empty model</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>lasso.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<style>#sk-container-id-6 {color: black;background-color: white;}#sk-container-id-6 pre{padding: 0;}#sk-container-id-6 div.sk-toggleable {background-color: white;}#sk-container-id-6 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-6 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-6 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-6 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-6 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-6 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-6 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-6 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-6 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-6 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-6 div.sk-item {position: relative;z-index: 1;}#sk-container-id-6 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-6 div.sk-item::before, #sk-container-id-6 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-6 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-6 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-6 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-6 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-6 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-6 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-6 div.sk-label-container {text-align: center;}#sk-container-id-6 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-6 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Lasso()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" checked=""><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">Lasso</label><div class="sk-toggleable__content"><pre>Lasso()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-5" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-5">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> lasso.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> lasso.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  10.803674844089155
Train MAE:  2.114463667931643
Train R2 :  0.9331701327597102
Test MSE :  12.31267791019369
Test MAE :  2.451668460517636
Test R2  :  0.9026694855698271</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-4" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-4">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>    lasso <span class="op">=</span> Lasso() <span class="co"># empty model</span></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>    lasso.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> lasso.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> lasso.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb74-55"><a href="#cb74-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb74-56"><a href="#cb74-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-57"><a href="#cb74-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb74-58"><a href="#cb74-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  12.926952290280251
MSE test :  14.69385558875688
MAE train:  2.196124193034645
MAE test :  2.2116112429073675
R2 train :  0.9013370613276945
R2 test  :  0.870326895389766</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Ridge
</summary>
<section>
</section>
<section id="loading-and-pre-processing-6" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-6">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Ridge <span class="co"># Ridge Model</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-6" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-6">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create model</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>ridge <span class="op">=</span> Ridge() <span class="co"># empty model</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>ridge.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<style>#sk-container-id-7 {color: black;background-color: white;}#sk-container-id-7 pre{padding: 0;}#sk-container-id-7 div.sk-toggleable {background-color: white;}#sk-container-id-7 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-7 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-7 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-7 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-7 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-7 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-7 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-7 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-7 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-7 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-7 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-7 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-7 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-7 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-7 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-7 div.sk-item {position: relative;z-index: 1;}#sk-container-id-7 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-7 div.sk-item::before, #sk-container-id-7 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-7 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-7 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-7 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-7 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-7 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-7 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-7 div.sk-label-container {text-align: center;}#sk-container-id-7 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-7 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-7" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Ridge()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" checked=""><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="evaluate-the-model-6" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-6">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> ridge.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> ridge.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train MSE:  7.7930887896889125
Train MAE:  2.0494809331726525
Train R2 :  0.7977842775312494
Test MSE :  12.591543713600217
Test MAE :  2.108346520061348
Test R2  :  0.920003619900187</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-5" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-5">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create model</span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>    ridge <span class="op">=</span> Ridge() <span class="co"># empty model</span></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model</span></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>    ridge.fit(X_train, y_train) <span class="co"># fit model (aka learn the model parameters)</span></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> ridge.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> ridge.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-57"><a href="#cb87-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb87-58"><a href="#cb87-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE train:  10.24146973258362
MSE test :  12.12979060761204
MAE train:  2.1435906799017608
MAE test :  2.2070635596826342
R2 train :  0.9221523620606501
R2 test  :  0.8748836120372152</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
<details>
<summary>
Neural Network
</summary>
<section>
</section>
<section id="loading-and-pre-processing-7" class="level4">
<h4 class="anchored" data-anchor-id="loading-and-pre-processing-7">Loading and Pre-Processing</h4>
<p>First, we need to import our packages and load in our data.</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't show warnings so that we can have blissful ignorance</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co"># base packages</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co"># modelling imports</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow.keras <span class="im">as</span> kb</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelBinarizer <span class="co">#Z-score variables, binary</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score <span class="co">#model evaluation</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split <span class="co"># simple TT split cv</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold <span class="co"># k-fold cv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2023-06-24 16:15:34.105729: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/cmparlettpelleriti/CPSC392ParlettPelleriti/master/Data/amazon-books.txt"</span>,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                 sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="co">#file is tsv not csv, so sep = "\t"</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ama.head()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to do any pre-processing we need. Here weâ€™ll check the number of missing values to see if we need to drop any.</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check null</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.isnull().<span class="bu">sum</span>()) <span class="co"># check if too many are missing</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ama.shape) <span class="co"># how many rows, cols to we have?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Title           0
Author          1
List Price      1
Amazon Price    0
Hard/ Paper     0
NumPages        2
Publisher       1
Pub year        1
ISBN-10         0
Height          4
Width           5
Thick           1
Weight (oz)     9
dtype: int64
(325, 13)</code></pre>
</div>
</div>
<p>There arenâ€™t many missing values here, compared to the number of rows, so I feel comfortable dropping any row thatâ€™s missing a value. So letâ€™s do that.</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop missing</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.dropna() <span class="co"># drop missing rows</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>ama <span class="op">=</span> ama.reset_index() <span class="co"># reset indices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we drop missing values, and reset the indices. <code>dropna()</code> will by default drop any row thatâ€™s missing a value. Say we have 5 rows, and our row indices are 0,1,2,3 and 4. If row 2 has a missing value, <code>dropna()</code> will drop it. But now our indices are weird, because it goes 0,1,3,4 instead of 0,1,2,3. <code>reset_index()</code> will take our data and make sure there are no skipped indices.</p>
<p>Now we can prepare to build our model by separating the data into predictors (inputs to the model) and an outcome (the output of the model; what itâ€™s predicting). Weâ€™ll also turn <code>Hard/ Paper</code> into a binary (0/1) variable so that our model can process it.</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up X and y</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>, <span class="st">"Hard/ Paper"</span>] <span class="co"># specify predictor vars</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ama[predictors] <span class="co"># predictors/input</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ama[<span class="st">"Amazon Price"</span>] <span class="co"># outcome/output</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="co"># binary</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> LabelBinarizer()</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>X[<span class="st">"Hard/ Paper"</span>] <span class="op">=</span> b.fit_transform(X[<span class="st">"Hard/ Paper"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to separate our data into a <em>training</em> and <em>testing</em> set. The train set will be used to fit the model, and the test set will be used to help us understand how the model performs on data it has never seen before. We are VERY careful to make sure that no information from the test set leaks into the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true" href="">Train Test Split</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false" href="">K-Fold</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>X_test, X_train, y_test, y_train <span class="op">=</span> train_test_split(X,y, test_size <span class="op">=</span> <span class="fl">0.2</span>) <span class="co">#80/20 TTS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z score</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="build-and-fit-the-model-7" class="level4">
<h4 class="anchored" data-anchor-id="build-and-fit-the-model-7">Build and Fit the Model</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#structure of the model</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> kb.Sequential([</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    kb.layers.Dense(<span class="dv">1</span>, input_shape <span class="op">=</span>[<span class="dv">7</span>]), <span class="co">#input</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co">#how to train the model</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">"mean_squared_error"</span>,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>              optimizer <span class="op">=</span> kb.optimizers.SGD())</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co">#fit the model (same as SKlearn)</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>model.fit(X_train,y_train, epochs <span class="op">=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 168.84322/2 [==============================] - 0s 6ms/step - loss: 199.1377
Epoch 2/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 182.71282/2 [==============================] - 0s 3ms/step - loss: 177.1765
Epoch 3/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 180.92072/2 [==============================] - 0s 3ms/step - loss: 158.5030
Epoch 4/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 139.54752/2 [==============================] - 0s 2ms/step - loss: 141.9178
Epoch 5/5
1/2 [==============&gt;...............] - ETA: 0s - loss: 120.03192/2 [==============================] - 0s 2ms/step - loss: 126.9031</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>&lt;keras.callbacks.History at 0x7f7f54db6fd0&gt;</code></pre>
</div>
</div>
</section>
<section id="evaluate-the-model-7" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-the-model-7">Evaluate the Model</h4>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-sqaured (R2) values.</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>price_pred_train <span class="op">=</span> model.predict(X_train) <span class="co"># make predictions for data in X</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MSE: "</span>, mean_squared_error(y_train,price_pred_train))</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train MAE: "</span>, mean_absolute_error(y_train,price_pred_train))</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Train R2 : "</span>, r2_score(y_train,price_pred_train))</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="co"># predict</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>price_pred_test <span class="op">=</span> model.predict(X_test) <span class="co"># make predictions for data in X</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="co"># mse and mae</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MSE : "</span>, mean_squared_error(y_test,price_pred_test))</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test MAE : "</span>, mean_absolute_error(y_test,price_pred_test))</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r2</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test R2  : "</span>, r2_score(y_test,price_pred_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 3ms/step
Train MSE:  116.76625456004425
Train MAE:  9.590928357185858
Train R2 :  -2.380671940213246
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 723us/step
Test MSE :  210.1383965866199
Test MAE :  9.835787255437143
Test R2  :  -0.3266095458929097</code></pre>
</div>
</div>
</section>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<p><strong>NOTE</strong>: Weâ€™re building a pretty simple feed forward NN here, once the models get a little bigger, K-Fold can sometimes be too computationally expensive to run.</p>
<p>To use KFold, we need to create a <code>for</code> loop which repeats our code <code>K</code> times (here, <code>K</code> is 5, for 5-Fold CV). The variables <code>train</code> and <code>test</code> contain the indices of the rows that should be in the train and test sets, respectively. Each time our for loop iterates, we will grab the rows in <code>X</code> that should be in the training set and put them in <code>X_train</code>, we will grab the rows in <code>X</code> that should be in the testing set and put them in <code>X_test</code>, we will grab the rows in <code>y</code> that should be in the training set and put them in <code>y_train</code>, and we will grab the rows in <code>y</code> that should be in the testing set and put them in <code>y_test</code>.</p>
<p>Then, weâ€™ll z-score our inputs. All our predictors except <code>Hard/ Paper</code> are continuous, so weâ€™ll z-score all of them except <code>Hard/ Paper</code>.</p>
<section id="model-building-and-evaluation-6" class="level4">
<h4 class="anchored" data-anchor-id="model-building-and-evaluation-6">Model Building and Evaluation</h4>
<p>Now, weâ€™re ready to build the model. First, we create an empty model, and then we fit it. Fitting allows the empty model to use the data we give it (here <code>X</code> and <code>y</code>) to figure out what the parameters of the model should be. Here the parameters are the intercept and coefficient of the model.</p>
<p>Now that we have a fitted model, we need to check how well it performs. For a continuous outcome, we often check the Mean Squared Error (MSE), Mean Absolute Error (MAE) and R-squared (R2) values. Because weâ€™re doing K-Fold CV, weâ€™ll have K different MSEs, MAEs, and R2s for the train/test set. So, we store all K of them in lists (<code>mae_train</code>, <code>mae_test</code>â€¦etc).</p>
<p>All three of these metrics compare the <em>actual</em> outcomes (here, Amazon Price) with what the model <em>predicts</em> the outcome will be. So first, we generate predictions for our dataset, then we use these predictions and the actual values (in <code>y</code>) to calculate these three metrics. Weâ€™ll do this for both the train and the test set.</p>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(<span class="dv">5</span>) <span class="co"># 5-Fold CV</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>mse_train <span class="op">=</span> []</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>mse_test  <span class="op">=</span> []</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>mae_train <span class="op">=</span> []</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>mae_test  <span class="op">=</span> []</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>r2_train   <span class="op">=</span> []</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>r2_test    <span class="op">=</span> []</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>continuous <span class="op">=</span>  [<span class="st">"List Price"</span>, <span class="st">"NumPages"</span>,</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Weight (oz)"</span>, <span class="st">"Thick"</span>,</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Height"</span>, <span class="st">"Width"</span>] <span class="co"># specify continuous vars</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train,test <span class="kw">in</span> kf.split(X):</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split into train/test</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train]</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test]</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y[train]</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y[test]</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z score</span></span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> StandardScaler() <span class="co"># create empty z-score object</span></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>    z.fit(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>    X_train[continuous] <span class="op">=</span> z.transform(X_train[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>    X_test[continuous] <span class="op">=</span> z.transform(X_test[continuous]) <span class="co"># all predictors are continuous/interval</span></span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#structure of the model</span></span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> kb.Sequential([</span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a>        kb.layers.Dense(<span class="dv">1</span>, input_shape <span class="op">=</span>[<span class="dv">7</span>]), <span class="co">#input</span></span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb103-33"><a href="#cb103-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-34"><a href="#cb103-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#how to train the model</span></span>
<span id="cb103-35"><a href="#cb103-35" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">"mean_squared_error"</span>,</span>
<span id="cb103-36"><a href="#cb103-36" aria-hidden="true" tabindex="-1"></a>                  optimizer <span class="op">=</span> kb.optimizers.SGD())</span>
<span id="cb103-37"><a href="#cb103-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-38"><a href="#cb103-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">#fit the model (same as SKlearn)</span></span>
<span id="cb103-39"><a href="#cb103-39" aria-hidden="true" tabindex="-1"></a>    model.fit(X_train,y_train, epochs <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb103-40"><a href="#cb103-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-41"><a href="#cb103-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict</span></span>
<span id="cb103-42"><a href="#cb103-42" aria-hidden="true" tabindex="-1"></a>    price_pred_train <span class="op">=</span> model.predict(X_train) <span class="co"># make predictions for data in X_train</span></span>
<span id="cb103-43"><a href="#cb103-43" aria-hidden="true" tabindex="-1"></a>    price_pred_test <span class="op">=</span> model.predict(X_test) <span class="co"># make predictions for data in X_test</span></span>
<span id="cb103-44"><a href="#cb103-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-45"><a href="#cb103-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb103-46"><a href="#cb103-46" aria-hidden="true" tabindex="-1"></a>    mse_train.append(mean_squared_error(y_train, price_pred_train))</span>
<span id="cb103-47"><a href="#cb103-47" aria-hidden="true" tabindex="-1"></a>    mse_test.append(mean_squared_error(y_test, price_pred_test))</span>
<span id="cb103-48"><a href="#cb103-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-49"><a href="#cb103-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mae</span></span>
<span id="cb103-50"><a href="#cb103-50" aria-hidden="true" tabindex="-1"></a>    mae_train.append(mean_absolute_error(y_train, price_pred_train))</span>
<span id="cb103-51"><a href="#cb103-51" aria-hidden="true" tabindex="-1"></a>    mae_test.append(mean_absolute_error(y_test, price_pred_test))</span>
<span id="cb103-52"><a href="#cb103-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-53"><a href="#cb103-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">#r2</span></span>
<span id="cb103-54"><a href="#cb103-54" aria-hidden="true" tabindex="-1"></a>    r2_train.append(r2_score(y_train, price_pred_train))</span>
<span id="cb103-55"><a href="#cb103-55" aria-hidden="true" tabindex="-1"></a>    r2_test.append(r2_score(y_test, price_pred_test))</span>
<span id="cb103-56"><a href="#cb103-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-57"><a href="#cb103-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE train: "</span>, np.mean(mse_train))</span>
<span id="cb103-58"><a href="#cb103-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MSE test : "</span>, np.mean(mse_test))   </span>
<span id="cb103-59"><a href="#cb103-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-60"><a href="#cb103-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE train: "</span>, np.mean(mae_train))</span>
<span id="cb103-61"><a href="#cb103-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MAE test : "</span>, np.mean(mae_test))   </span>
<span id="cb103-62"><a href="#cb103-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-63"><a href="#cb103-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 train : "</span>, np.mean(r2_train))</span>
<span id="cb103-64"><a href="#cb103-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 test  : "</span>, np.mean(r2_test))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/5
1/8 [==&gt;...........................] - ETA: 1s - loss: 667.47978/8 [==============================] - 0s 1ms/step - loss: 222.2694
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 130.17118/8 [==============================] - 0s 1ms/step - loss: 143.8229
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 44.16568/8 [==============================] - 0s 1ms/step - loss: 99.1519
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 32.52808/8 [==============================] - 0s 997us/step - loss: 71.7632
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 26.27118/8 [==============================] - 0s 892us/step - loss: 52.3293
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 850us/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 1s - loss: 191.84648/8 [==============================] - 0s 1ms/step - loss: 201.6116
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 166.13428/8 [==============================] - 0s 974us/step - loss: 123.0343
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 190.09638/8 [==============================] - 0s 948us/step - loss: 83.0737
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 34.60318/8 [==============================] - 0s 1ms/step - loss: 57.7068
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 17.19208/8 [==============================] - 0s 1ms/step - loss: 43.1821
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 905us/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 1s - loss: 180.02048/8 [==============================] - 0s 1ms/step - loss: 287.3770
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 79.28678/8 [==============================] - 0s 928us/step - loss: 181.5353
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 77.51178/8 [==============================] - 0s 866us/step - loss: 123.4429
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 89.93158/8 [==============================] - 0s 1ms/step - loss: 86.0724
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 32.27808/8 [==============================] - 0s 1ms/step - loss: 64.8376
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 968us/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 1s - loss: 165.12528/8 [==============================] - 0s 1ms/step - loss: 269.5117
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 281.59738/8 [==============================] - 0s 1ms/step - loss: 175.4793
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 68.37718/8 [==============================] - 0s 885us/step - loss: 120.9158
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 42.74788/8 [==============================] - 0s 976us/step - loss: 86.4426
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 92.74828/8 [==============================] - 0s 981us/step - loss: 65.6075
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 929us/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
Epoch 1/5
1/8 [==&gt;...........................] - ETA: 1s - loss: 485.83388/8 [==============================] - 0s 1ms/step - loss: 249.8147
Epoch 2/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 128.99598/8 [==============================] - 0s 1ms/step - loss: 160.7654
Epoch 3/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 148.50928/8 [==============================] - 0s 1ms/step - loss: 108.6868
Epoch 4/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 57.97078/8 [==============================] - 0s 1ms/step - loss: 76.8317
Epoch 5/5
1/8 [==&gt;...........................] - ETA: 0s - loss: 23.94018/8 [==============================] - 0s 896us/step - loss: 58.0639
1/8 [==&gt;...........................] - ETA: 0s8/8 [==============================] - 0s 989us/step
1/2 [==============&gt;...............] - ETA: 0s2/2 [==============================] - 0s 2ms/step
MSE train:  47.19111036368553
MSE test :  49.341898590609375
MAE train:  4.0725810223164105
MAE test :  4.08901809243233
R2 train :  0.6423904533985956
R2 test  :  0.5279138226246776</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></details>
</section>
</section>
<section id="classification-categorical-outcome" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="classification-categorical-outcome"><span class="header-section-number">2.2</span> Classification (Categorical Outcome)</h2>
<section id="logistic-regression" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">2.2.1</span> Logistic Regression</h3>
</section>
<section id="knn" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="knn"><span class="header-section-number">2.2.2</span> KNN</h3>
</section>
<section id="naive-bayes" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="naive-bayes"><span class="header-section-number">2.2.3</span> Naive Bayes</h3>
</section>
<section id="decision-trees" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="decision-trees"><span class="header-section-number">2.2.4</span> Decision Trees</h3>
</section>
<section id="random-forest" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5" class="anchored" data-anchor-id="random-forest"><span class="header-section-number">2.2.5</span> Random Forest</h3>
</section>
<section id="neural-network" class="level3" data-number="2.2.6">
<h3 data-number="2.2.6" class="anchored" data-anchor-id="neural-network"><span class="header-section-number">2.2.6</span> Neural Network</h3>
</section>
</section>

<section id="unsupervised-machine-learning" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Unsupervised Machine Learning</h1>
<section id="clustering" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="clustering"><span class="header-section-number">3.1</span> Clustering</h2>
<section id="kmeans" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="kmeans"><span class="header-section-number">3.1.1</span> KMeans</h3>
</section>
<section id="gaussian-mixture-model" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="gaussian-mixture-model"><span class="header-section-number">3.1.2</span> Gaussian Mixture Model</h3>
</section>
<section id="dbscan" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="dbscan"><span class="header-section-number">3.1.3</span> DBSCAN</h3>
</section>
<section id="hierarchical-agglomerative-clustering" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4" class="anchored" data-anchor-id="hierarchical-agglomerative-clustering"><span class="header-section-number">3.1.4</span> Hierarchical Agglomerative Clustering</h3>
</section>
</section>
<section id="dimensionality-reduction" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="dimensionality-reduction"><span class="header-section-number">3.2</span> Dimensionality Reduction</h2>
<section id="pca" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="pca"><span class="header-section-number">3.2.1</span> PCA</h3>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>